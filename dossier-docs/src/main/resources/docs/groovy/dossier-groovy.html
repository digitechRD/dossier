<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Digitech">
<link rel="icon" type="image/png" href="images/icons/arcade_favicon-32x32.png">
<title>Personnalisation de l&#8217;application Arcade GED à l&#8217;aide de scripts Groovy</title>
<link rel="stylesheet" href="css/digitech.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="highlightjs/styles/github.min.css">
<!--
<meta name="theme-color" content="#319197" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#872e4e" media="(prefers-color-scheme: dark)">
-->
<script src="echarts/echarts.min.js"></script>
<script src="js/setup.js"></script><script defer src="js/site.js"></script>

</head>
<body id="Dossier-groovy" class="book toc2 toc-left">
<div id="banner-container" class="container" role="banner">
    <div id="banner" class="contained" role="banner">
        <div id="switch-theme">
            <input type="checkbox" id="switch-theme-checkbox"/>
            <label for="switch-theme-checkbox">Dark Theme</label>
        </div>
    </div>
</div>
<div id="header">
<h1>Personnalisation de l&#8217;application <code><span style="color:#448279">Arcade GED</span></code> à l&#8217;aide de scripts Groovy</h1>
<div class="details">
<span id="author" class="author">Digitech</span><br>
<span id="revnumber">version 1.1,</span>
<span id="revdate">14/02/2025 15:20:34</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Sommaire</div>
<ul class="sectlevel1">
<li><a href="#_01_intro">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_objet_du_document">1.1. Objet du document</a></li>
<li><a href="#_bonnes_pratiques_et_astuces_arcade_ged">1.2. Bonnes pratiques et astuces <code><span style="color:#2C8470">Arcade GED</span></code></a></li>
</ul>
</li>
<li><a href="#_01_CommonData">2. Données communes à chaque script</a></li>
<li><a href="#_02_AttachmentDisplaySorting">3. AttachmentDisplaySorting</a>
<ul class="sectlevel2">
<li><a href="#_description">3.1. Description</a></li>
<li><a href="#_paramètres">3.2. Paramètres</a></li>
<li><a href="#_sample">3.3. Sample</a></li>
</ul>
</li>
<li><a href="#_03_AttachmentInitializer">4. AttachmentInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_2">4.1. Description</a></li>
<li><a href="#_paramètres_2">4.2. Paramètres</a></li>
<li><a href="#_sample_2">4.3. Sample</a></li>
</ul>
</li>
<li><a href="#_04_AttachmentTableSorting">5. AttachmentTableSorting</a>
<ul class="sectlevel2">
<li><a href="#_description_3">5.1. Description</a></li>
<li><a href="#_paramètres_3">5.2. Paramètres</a></li>
<li><a href="#_exemple">5.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_05_AttachmentUploaded">6. AttachmentUploaded</a>
<ul class="sectlevel2">
<li><a href="#_description_4">6.1. Description</a></li>
<li><a href="#_paramètres_4">6.2. Paramètres</a></li>
<li><a href="#_exemple_2">6.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_06_BasketInitializer">7. BasketInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_5">7.1. Description</a></li>
<li><a href="#_paramètres_5">7.2. Paramètres</a></li>
<li><a href="#_exemple_3">7.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_07_ConnectorPropertiesInitializer">8. ConnectorPropertiesInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_6">8.1. Description</a></li>
<li><a href="#_paramètres_6">8.2. Paramètres</a></li>
<li><a href="#_sample_3">8.3. Sample</a></li>
</ul>
</li>
<li><a href="#_08_CustomHomeBlock">9. CustomHomeBlock</a>
<ul class="sectlevel2">
<li><a href="#_description_7">9.1. Description</a></li>
<li><a href="#_paramètres_7">9.2. Paramètres</a></li>
<li><a href="#_exemple_4">9.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_09_DisplayRule">10. DisplayRule</a>
<ul class="sectlevel2">
<li><a href="#_description_8">10.1. Description</a></li>
<li><a href="#_paramètres_8">10.2. Paramètres</a></li>
<li><a href="#_exemple_5">10.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_10_DocCreation">11. DocCreation</a>
<ul class="sectlevel2">
<li><a href="#_description_9">11.1. Description</a></li>
<li><a href="#_paramètres_9">11.2. Paramètres</a></li>
<li><a href="#_exemple_6">11.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_11_DocumentActions">12. DocumentActions</a>
<ul class="sectlevel2">
<li><a href="#_description_10">12.1. Description</a></li>
<li><a href="#_paramètres_10">12.2. Paramètres</a></li>
<li><a href="#_exemple_7">12.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_12_DocumentChecker">13. DocumentChecker</a>
<ul class="sectlevel2">
<li><a href="#_description_11">13.1. Description</a></li>
<li><a href="#_paramètres_11">13.2. Paramètres</a></li>
<li><a href="#_exemples">13.3. Exemples</a></li>
</ul>
</li>
<li><a href="#_13_DocumentInitializer">14. DocumentInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_12">14.1. Description</a></li>
<li><a href="#_paramètres_12">14.2. Paramètres</a></li>
<li><a href="#_exemple_8">14.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_14_ElementFilter">15. ElementFilter</a>
<ul class="sectlevel2">
<li><a href="#_description_13">15.1. Description</a></li>
<li><a href="#_paramètres_13">15.2. Paramètres</a></li>
<li><a href="#_exemple_9">15.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_15_ExportInitializer">16. ExportInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_14">16.1. Description</a></li>
<li><a href="#_paramètres_14">16.2. Paramètres</a></li>
<li><a href="#_exemple_10">16.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_16_ExternalScript">17. ExternalScript</a>
<ul class="sectlevel2">
<li><a href="#_description_15">17.1. Description</a></li>
<li><a href="#_exemple_11">17.2. Exemple</a></li>
</ul>
</li>
<li><a href="#_17_FieldDependency">18. FieldDependency</a>
<ul class="sectlevel2">
<li><a href="#_description_16">18.1. Description</a></li>
<li><a href="#_paramètres_15">18.2. Paramètres</a></li>
<li><a href="#_exemple_12">18.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_18_FieldInitializer">19. FieldInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_17">19.1. Description</a></li>
<li><a href="#_paramètres_16">19.2. Paramètres</a></li>
<li><a href="#_exemple_13">19.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_19_GlobalLibrary">20. GlobalLibrary</a>
<ul class="sectlevel2">
<li><a href="#_description_18">20.1. Description</a></li>
<li><a href="#_exemple_14">20.2. Exemple</a></li>
</ul>
</li>
<li><a href="#_20_HierarchicalTreeNodeInitializer">21. HierarchicalTreeNodeInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_19">21.1. Description</a></li>
<li><a href="#_paramètres_17">21.2. Paramètres</a></li>
<li><a href="#_exemple_15">21.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_21_Task">22. Task</a>
<ul class="sectlevel2">
<li><a href="#_description_20">22.1. Description</a></li>
<li><a href="#_paramètres_18">22.2. Paramètres</a></li>
<li><a href="#_exemple_16">22.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_22_WSAttachmentInitializer">23. WSAttachmentInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_21">23.1. Description</a></li>
<li><a href="#_paramètres_19">23.2. Paramètres</a></li>
<li><a href="#_exemple_17">23.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_23_WSDocumentInitializer">24. WSDocumentInitializer</a>
<ul class="sectlevel2">
<li><a href="#_description_22">24.1. Description</a></li>
<li><a href="#_paramètres_20">24.2. Paramètres</a></li>
<li><a href="#_exemple_18">24.3. Exemple</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/arcade-cover.png" alt="arcade cover">
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch tableBorder stripes-none">
<colgroup>
<col style="width: 37.5%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock text-left filtered max-width-400 m-auto">
<div class="content">
<img src="images/icons/digitech_logo_and_text.svg" alt="digitech logo and text">
</div>
</div></div></td>
<td class="tableblock halign-left valign-bottom" rowspan="2"><div class="content"><div class="paragraph">
<p><code>Digitech SA</code><br>
<em>ZAC Saumaty Séon - 21 av. Fernand Sardou - CS 40173<br>
13322 Marseille Cedex 16</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Copyright (c) 2025 <code>Digitech SA</code>, tous droits réservés.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 1. Notes de suivi</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">État</th>
<th class="tableblock halign-left valign-top">Objet</th>
<th class="tableblock halign-left valign-top">Rédacteur</th>
<th class="tableblock halign-left valign-top">Validateur</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">02/08/2024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Création du document</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="res">MRA</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="res">NFE</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14/02/2025</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ajout d&#8217;exemples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="res">NFE</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_01_intro"><a class="anchor" href="#_01_intro"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objet_du_document"><a class="anchor" href="#_objet_du_document"></a>1.1. Objet du document</h3>
<div class="paragraph">
<p>Ce document décrit les différents scripts <code><span style="color:#2C8470">Arcade GED</span></code> permettant la personnalisation d&#8217;Arcade GED.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bonnes_pratiques_et_astuces_arcade_ged"><a class="anchor" href="#_bonnes_pratiques_et_astuces_arcade_ged"></a>1.2. Bonnes pratiques et astuces <code><span style="color:#2C8470">Arcade GED</span></code></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Variables en entrée.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Toutes les variables contextuelles transférées par l&#8217;application <code><span style="color:#448279">Arcade GED</span></code> sont préfixées du caractère <strong>_</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Opérateur <strong>elvis</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le langage <code><span style="color:#2C8470">Arcade GED</span></code> est (très) proche du langage <code><span style="color:#F24E52">Java</span></code>. En tout cas, le compilateur <code><span style="color:#2C8470">Arcade GED</span></code> interprète une syntaxe <strong>pure</strong> <code><span style="color:#F24E52">Java</span></code>.</p>
</div>
<div class="paragraph">
<p>Cependant, le langage se trouve enrichi (<em>du point de vue de l&#8217;auteur de ce document <span class="image emoji size-20"><img src="images/icons/smile-ok.svg" alt="ok" width="24" height="24"></span></em>) par certaines caractéristiques, notamment l&#8217;opérateur <a href="https://docs.groovy-lang.org/next/html/documentation/core-operators.html#_elvis_operator" target="_blank" rel="noopener"><strong>elvis</strong></a>, un raccourci à l&#8217;opérateur ternaire <code><span style="color:#F24E52">Java</span></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">displayName = user.name ? user.name : 'Anonymous'
// devient
displayName = user.name ?: 'Anonymous'</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Opérateur de navigation <em>"sécurisé"</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ou dans la langue de <em>Shakespeare</em> <strong>Safe Navigation Operator</strong>.</p>
</div>
<div class="paragraph">
<p>L&#8217;opérateur est identique à <em>elvis</em> et permet d&#8217;appel à des méthodes d&#8217;objet sans crainte de <strong>NullPointerException</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">// si person ou address ou home est NULL, roadNumber sera NULL
def roadNumber = person?.address?.home?.roadNumber</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Astuce"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Les <strong>2</strong> opérateurs précédemment décrits peuvent être utilisés conjointement !</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def roadNumber = person?.address?.home?.roadNumber ?: 666</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_01_CommonData"><a class="anchor" href="#_01_CommonData"></a>2. Données communes à chaque script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;ensemble des scripts décrit dans les chapitres suivants contiennent les 2 paramètres suivants :</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 57.1429%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_logger</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>org.log4j.Logger</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Logger</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_userContext</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IUserCoreContext</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Informations relatives à l&#8217;utilisateur exécutant le script.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_output</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.IScriptResultModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>Généralement</em> non utilisé directement dans les scripts.<br>
La variable suivante <strong>_result</strong> semble convenir à la plupart des cas.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.IScriptResultValueModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Structure de retour. Voir pour chaque script la liste des attributs disponibles.<br>
Les attributs communs sont :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>status</strong> : de type <strong>com.digitech.common.script.model.EnumScriptStatus</strong></p>
</li>
<li>
<p><strong>messageSeverity</strong> : de type <strong>com.digitech.dossier.script.model.IScriptResultValueModel#Severity</strong></p>
</li>
<li>
<p><strong>messageSummary</strong> : message si nécessaire</p>
</li>
<li>
<p><strong>messageDetail</strong> : message détaillé si nécessaire</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_02_AttachmentDisplaySorting"><a class="anchor" href="#_02_AttachmentDisplaySorting"></a>3. AttachmentDisplaySorting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description"><a class="anchor" href="#_description"></a>3.1. Description</h3>
<div class="paragraph">
<p>Ce script permet de définir quelle pièce jointe est affichée <em>par défaut</em> en vue hiérarchique.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres"><a class="anchor" href="#_paramètres"></a>3.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ID du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachmentList</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IAttachment&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des pièces jointes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueAttachmentToDisplay</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>document</strong> et <strong>attachment</strong>
correspondant au document et sa pièce jointe à afficher</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_sample"><a class="anchor" href="#_sample"></a>3.3. Sample</h3>
<div class="paragraph">
<p>Tri de la liste des pièces jointes par ordre alphabétique.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.impl.comparator.AttachmentComparator
import org.apache.commons.collections4.CollectionUtils

if(CollectionUtils.isNotEmpty(_attachmentList)) {
  _result.attachment = _attachmentList.get(0)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_03_AttachmentInitializer"><a class="anchor" href="#_03_AttachmentInitializer"></a>4. AttachmentInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_2"><a class="anchor" href="#_description_2"></a>4.1. Description</h3>
<div class="paragraph">
<p><em>à documenter</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_2"><a class="anchor" href="#_paramètres_2"></a>4.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ID du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueChecker</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>valid</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_sample_2"><a class="anchor" href="#_sample_2"></a>4.3. Sample</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_04_AttachmentTableSorting"><a class="anchor" href="#_04_AttachmentTableSorting"></a>5. AttachmentTableSorting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_3"><a class="anchor" href="#_description_3"></a>5.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé lors de la récupération des pièces jointes d&#8217;un document, afin de les trier avant de les afficher.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_3"><a class="anchor" href="#_paramètres_3"></a>5.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ID du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachmentList</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IAttachment&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des pièces jointes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueAttachmentToDisplay</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>document</strong> et <strong>attachment</strong>
correspondant au document et sa pièce jointe à afficher</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple"><a class="anchor" href="#_exemple"></a>5.3. Exemple</h3>
<div class="paragraph">
<p>Tri de la liste des pièces jointes par ordre alphabétique.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.impl.comparator.AttachmentComparator
import org.apache.commons.collections4.CollectionUtils

if(CollectionUtils.isNotEmpty(_attachmentList)) {
  _attachmentList.sort(AttachmentComparator.ATT_LABEL_COMP)
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;affichage d&#8217;une liste de pièces jointes triées par ordre alphabétique</div>
<p><span class="image"><img src="images/examples/attachment_table_sorting_example.png" alt="attachment table sorting example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_05_AttachmentUploaded"><a class="anchor" href="#_05_AttachmentUploaded"></a>6. AttachmentUploaded</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_4"><a class="anchor" href="#_description_4"></a>6.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé lorsque l&#8217;on dépose une pièce jointe.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_4"><a class="anchor" href="#_paramètres_4"></a>6.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_mode</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>AttachmentUploadEventMode</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode (ajout/suppression)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.SimpleScriptResultModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>--</em></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_2"><a class="anchor" href="#_exemple_2"></a>6.3. Exemple</h3>
<div class="paragraph">
<p>Remplissage du champ <em>Désignation</em> lors de la création d&#8217;un compte-rendu via le dépôt de pièce jointe depuis la page d&#8217;accueil.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.FieldUtils
import com.digitech.dossier.script.model.impl.typedef.AttachmentUploadEventMode

des = FieldUtils.getValue(_document, "CR_DES")

if(_mode == AttachmentUploadEventMode.REMOVE) {
  if(_attachment?.fileName == des) {
    FieldUtils.setValue(_document, "CR_DES", null)
  }
}
else {
  if(des == null) {
    FieldUtils.setValue(_document, "CR_DES", _attachment?.fileName)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de création de compte-rendu avec pièce jointe</div>
<p><span class="image"><img src="images/examples/attachment_uploaded_example.png" alt="attachment uploaded example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_06_BasketInitializer"><a class="anchor" href="#_06_BasketInitializer"></a>7. BasketInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_5"><a class="anchor" href="#_description_5"></a>7.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé pour initialiser les bannettes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_5"><a class="anchor" href="#_paramètres_5"></a>7.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_basket</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IBasketModel</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Bannette</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueBasketInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>properties</strong> qui contient les propriétés
de la bannette</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_3"><a class="anchor" href="#_exemple_3"></a>7.3. Exemple</h3>
<div class="paragraph">
<p>Masquer les bannettes ne contenant aucun document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueBasketInitializer

if(_basket.getResultNumber(_userContext) == 0) {
  _result.getProperties().put(ScriptResultValueBasketInitializer.BasketProperty.DISPLAYED, "false")
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de liste des bannettes (sans script)</div>
<p><span class="image"><img src="images/examples/basket_initializer_example_without_script.png" alt="basket initializer example without script"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple de liste des bannettes (avec script)</div>
<p><span class="image"><img src="images/examples/basket_initializer_example_with_script.png" alt="basket initializer example with script"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_07_ConnectorPropertiesInitializer"><a class="anchor" href="#_07_ConnectorPropertiesInitializer"></a>8. ConnectorPropertiesInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_6"><a class="anchor" href="#_description_6"></a>8.1. Description</h3>
<div class="paragraph">
<p><em>à documenter</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_6"><a class="anchor" href="#_paramètres_6"></a>8.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_flowModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flow code</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueConnectorRule</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>annexeDocument</strong>: liste de <strong>IAttachment</strong></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_sample_3"><a class="anchor" href="#_sample_3"></a>8.3. Sample</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_08_CustomHomeBlock"><a class="anchor" href="#_08_CustomHomeBlock"></a>9. CustomHomeBlock</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_7"><a class="anchor" href="#_description_7"></a>9.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé pour l&#8217;affichage des blocs personnalisables de l&#8217;écran d&#8217;accueil</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_7"><a class="anchor" href="#_paramètres_7"></a>9.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parameterMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.CustomBlockScriptResultModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les propriétés du bloc</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_4"><a class="anchor" href="#_exemple_4"></a>9.3. Exemple</h3>
<div class="paragraph">
<p>Personnalisation du style de l&#8217;entête avec un aspect de sous-titre ("h2").</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">_model.setHeaderStyleClass("h2")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_09_DisplayRule"><a class="anchor" href="#_09_DisplayRule"></a>10. DisplayRule</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_8"><a class="anchor" href="#_description_8"></a>10.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est déclenché pour l&#8217;affichage des actions personnalisées.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_8"><a class="anchor" href="#_paramètres_8"></a>10.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueDisplayRule</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>valid</strong> qui détermine l&#8217;affichage de l&#8217;action</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_5"><a class="anchor" href="#_exemple_5"></a>10.3. Exemple</h3>
<div class="paragraph">
<p>Affichage de l&#8217;action "Diffuser le CR à Digitech !" si le document contient des pièces jointes et que le champ <em>Thématique</em> contient la valeur <em>Réunion
transverse</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IDocument
import com.digitech.dossier.common.service.IAuthorityList
import com.digitech.dossier.common.service.ServiceManager
import com.digitech.jcorbairs.Term

Term updatedFieldCode = getAuthorityListService().getTerm((Integer) document.getField("CR_THEME").getValue())
_result.setValid(_document?.getAttachments(_userContext)?.size &gt; 0 &amp;&amp; updatedFieldCode?.getCode() == "TH_TRANS")

/**
 * @return IAuthorityList the Authority List
 */
public static IAuthorityList getAuthorityListService() {
  return (IAuthorityList) ServiceManager.getInstance().getService(com.digitech.dossier.common.service.Constants.SERVICE_AIRS_AUTHORITYLIST_MGR
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;affichage de l&#8217;action</div>
<p><span class="image"><img src="images/examples/display_rule_example_displayed.png" alt="display rule example displayed"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple où l&#8217;action est masquée</div>
<p><span class="image"><img src="images/examples/display_rule_example_hidden.png" alt="display rule example hidden"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_10_DocCreation"><a class="anchor" href="#_10_DocCreation"></a>11. DocCreation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_9"><a class="anchor" href="#_description_9"></a>11.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lors de la création d&#8217;un document, afin de préremplir les données du formulaire.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_9"><a class="anchor" href="#_paramètres_9"></a>11.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_updateFields</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Collection&lt;UpdateField&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Champs du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultDocCreationInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>updatedFields</strong> définissant les champs
affichés</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_6"><a class="anchor" href="#_exemple_6"></a>11.3. Exemple</h3>
<div class="paragraph">
<p>Ajout de l&#8217;utilisateur courant en tant que rédacteur et de la date du jour lorsque l&#8217;on accède à la page de création d&#8217;un document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IDocument
import java.time.LocalDate
import java.time.format.DateTimeFormatter
import com.digitech.dossier.common.utils.FieldUtils
import com.digitech.dossier.common.model.backend.params.UpdateField

def today = LocalDate.now().format(DateTimeFormatter.ofPattern("dd/MM/yyyy"))
UpdateField uf = _updateFields.get('CR_DATE')
if(uf != null) {
  FieldUtils.setValue(_document as IDocument, 'CR_DATE', today)
}
uf = _updateFields.get('CR_REDACTEUR')
if(uf != null) {
 FieldUtils.setValue(_document as IDocument, 'CR_REDACTEUR', _userContext.getUserId())
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de création d&#8217;un Compte rendu</div>
<p><span class="image"><img src="images/examples/doc_creation_example.png" alt="doc creation example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_11_DocumentActions"><a class="anchor" href="#_11_DocumentActions"></a>12. DocumentActions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_10"><a class="anchor" href="#_description_10"></a>12.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé lors de la récupération des actions pour un document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_10"><a class="anchor" href="#_paramètres_10"></a>12.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_fieldValueMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, IFieldValue&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des champs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>allActions</strong> (toutes les actions) et
<strong>unavailableActions</strong> (actions indisponibles)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_7"><a class="anchor" href="#_exemple_7"></a>12.3. Exemple</h3>
<div class="paragraph">
<p>Ajout de l&#8217;interdiction d&#8217;effectuer l&#8217;action <strong>Verrouiller</strong> pour un utilisateur n&#8217;ayant pas le profil <em>DOC_ADMIN_CLIENT</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IFieldValue
import com.digitech.dossier.common.utils.UserUtils
import com.digitech.dossier.script.model.impl.result.ScriptResultModel
import com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions

List&lt;ScriptResultValueDocumentActions.Action&gt; unavailableActions = new ArrayList&lt;ScriptResultValueDocumentActions.Action&gt;()
if(!UserUtils.hasProfile(_userContext, "DOS_ADMIN_CLIENT")) {
  unavailableActions.add(ScriptResultValueDocumentActions.Action.LOCK)
}
_result.getUnavailableActions().addAll(unavailableActions)</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de résultats de recherche pour un utilisateur n&#8217;ayant pas le droit de verrouiller les documents</div>
<p><span class="image"><img src="images/examples/document_actions_example.png" alt="document actions example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_12_DocumentChecker"><a class="anchor" href="#_12_DocumentChecker"></a>13. DocumentChecker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_11"><a class="anchor" href="#_description_11"></a>13.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé avant une recherche pour valider les critères.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_11"><a class="anchor" href="#_paramètres_11"></a>13.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_search</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ISearchModel</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Recherche</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>-parameters</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueChecker</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>valid</strong> qui détermine si la recherche est valide</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemples"><a class="anchor" href="#_exemples"></a>13.3. Exemples</h3>
<div class="listingblock">
<div class="title">Blocage d&#8217;une recherche si une certaine condition est rencontrée.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">boolean condition = checkIfSearchIsValid(_search)
result.setValid(condition)

private static boolean checkIfSearchIsValid(def sm) {
  //
  return ok
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ajout d&#8217;un critère de recherche</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">if(!userCanSeeArchiveFolder(_userContext)) {
  _search.setAirsRequest(_search.getAirsRequest(_userContext)) + " ET ARCHIVE=0"
}

private static boolean userCanSeeArchiveFolder(IUserCoreContext uc) {
  // whatever...
  return uc.getProfileCodeList().contains("ARCHIVE_RIGHT")
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_13_DocumentInitializer"><a class="anchor" href="#_13_DocumentInitializer"></a>14. DocumentInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_12"><a class="anchor" href="#_description_12"></a>14.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est déclenché lorsqu&#8217;une action personnalisée est lancée ou lors d&#8217;un export.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_12"><a class="anchor" href="#_paramètres_12"></a>14.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_airsDocument</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document Airs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>documentList</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_8"><a class="anchor" href="#_exemple_8"></a>14.3. Exemple</h3>
<div class="paragraph">
<p>Affichage d&#8217;un message à la fin d&#8217;une action personnalisée.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentInitializer
import com.digitech.dossier.script.model.IScriptResultValueModel.Severity

_result.setMessageSeverity(Severity.INFO)
_result.setMessageSummary("Action personnalisée sur le document '" + _document?.getAirsRefId() + "'")</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de message</div>
<p><span class="image"><img src="images/examples/document_initializer_example.png" alt="document initializer example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_14_ElementFilter"><a class="anchor" href="#_14_ElementFilter"></a>15. ElementFilter</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_13"><a class="anchor" href="#_description_13"></a>15.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé pour filtrer les listes d&#8217;éléments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_13"><a class="anchor" href="#_paramètres_13"></a>15.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_users</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;?&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des utilisateurs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_elements</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;?&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des éléments</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;?&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Variable <strong>_elements</strong> qui correspond à la liste des éléments en sortie</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_9"><a class="anchor" href="#_exemple_9"></a>15.3. Exemple</h3>
<div class="paragraph">
<p>Filtrage sur une liste d&#8217;utilisateurs : affichage des personnes dont le nom de famille commence par un "D".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.UserUtils
import com.digitech.jcorbairs.User

List&lt;User&gt; filteredList = _users.findAll({it.getLastName().startsWith("D")})
_elements.clear()
_elements.addAll(filteredList)</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de filtre sur une liste d&#8217;utilisateurs</div>
<p><span class="image"><img src="images/examples/element_filter_example.png" alt="element filter example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_15_ExportInitializer"><a class="anchor" href="#_15_ExportInitializer"></a>16. ExportInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_14"><a class="anchor" href="#_description_14"></a>16.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lorsqu&#8217;un export est lancé.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_14"><a class="anchor" href="#_paramètres_14"></a>16.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_documents</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IDocument&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste de documents à exporter</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueExportInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>fileResultPath</strong> et <strong>fileResultName</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_10"><a class="anchor" href="#_exemple_10"></a>16.3. Exemple</h3>
<div class="paragraph">
<p>Définition des variables <strong>fileResultPath</strong> et <strong>fileResultName</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">_result.setFileResultPath("fileResultPath")
_result.setFileResultName("fileResultName")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_16_ExternalScript"><a class="anchor" href="#_16_ExternalScript"></a>17. ExternalScript</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_15"><a class="anchor" href="#_description_15"></a>17.1. Description</h3>
<div class="paragraph">
<p>Ce type de script n&#8217;est pas directement géré par Dossier (librairies externes).</p>
</div>
</div>
<div class="sect2">
<h3 id="_exemple_11"><a class="anchor" href="#_exemple_11"></a>17.2. Exemple</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_17_FieldDependency"><a class="anchor" href="#_17_FieldDependency"></a>18. FieldDependency</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_16"><a class="anchor" href="#_description_16"></a>18.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lorsque l&#8217;on souhaite avoir une dépendance entre les valeurs de certains champs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_15"><a class="anchor" href="#_paramètres_15"></a>18.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_fieldToUpdate</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IField</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Champ à mettre à jour</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_fieldMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, IField&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des champs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_updatedField</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IField</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Champ que l&#8217;on modifie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_updateFieldValues</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parameterMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IParameter&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.IScriptResultModel&lt;T&gt;</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_12"><a class="anchor" href="#_exemple_12"></a>18.3. Exemple</h3>
<div class="paragraph">
<p>Modification de la liste des choix pour le champ <em>Plan de classement</em> lorsque la valeur du champ <em>Catégorie de document</em> est modifiée.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">List&lt;SelectItem&gt; selectItems = new SelectItemFactory().getAuthorities(_fieldToUpdate.getConfigField());
Term updatedFieldCode = getAuthorityListService().getTerm((Integer) _updatedField.getValue())

List&lt;SelectItem&gt; test = new ArrayList&lt;&gt;();
for(items in selectItems) {
  if(items.getValue() != null) {
    Term code = getAuthorityListService().getTerm((Integer) items.getValue());
    SelectItem item = new SelectItem()
    item.setLabel(code.getValues()[0] as String)
    item.setValue(code.getCode())
    test.add(item)
  }
}
List&lt;SelectItem&gt; filteredList = test.findAll({it.getValue().startsWith(updatedFieldCode.getCode() as String)})
HtmlSelectOneMenu component = ((HtmlSelectOneMenu)  ((UIComponent) _fieldToUpdate.getComponent()));
component.getChildren().get(0).setValue(filteredList);

/**
 * @return IAuthorityList the Authority List
 */
public static IAuthorityList getAuthorityListService() {
  return (IAuthorityList) ServiceManager.getInstance().getService(com.digitech.dossier.common.service.Constants.SERVICE_AIRS_AUTHORITYLIST_MGR);
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de choix pour la catégorie Commerce</div>
<p><span class="image"><img src="images/examples/field_dependency_example_commerce.png" alt="field dependency example commerce"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple de choix pour la catégorie Comptabilité</div>
<p><span class="image"><img src="images/examples/field_dependency_example_compta.png" alt="field dependency example compta"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_18_FieldInitializer"><a class="anchor" href="#_18_FieldInitializer"></a>19. FieldInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_17"><a class="anchor" href="#_description_17"></a>19.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lors de l&#8217;affichage des champs d&#8217;un document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_16"><a class="anchor" href="#_paramètres_16"></a>19.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_airsDocument</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document Airs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>parameters</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueFieldInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>results</strong>, <strong>properties</strong> et
<strong>validatorAttributs</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_13"><a class="anchor" href="#_exemple_13"></a>19.3. Exemple</h3>
<div class="paragraph">
<p>Affichage des champs <em>CR_REDACTEUR</em> et <em>CR_DATE</em> en lecture seule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueFieldInitializer

if(_updateField.getFieldCode() == "CR_REDACTEUR" || _updateField.getFieldCode() == "CR_DATE") {
  _result.getProperties().put(ScriptResultValueFieldInitializer.FieldProperty.READ_ONLY, "true")
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de champs en lecture seule lors de la création d&#8217;un compte-rendu</div>
<p><span class="image"><img src="images/examples/field_initializer_example.png" alt="field initializer example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_19_GlobalLibrary"><a class="anchor" href="#_19_GlobalLibrary"></a>20. GlobalLibrary</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_18"><a class="anchor" href="#_description_18"></a>20.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé pour définir des méthodes qui pourront être utilisées dans d&#8217;autres scripts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exemple_14"><a class="anchor" href="#_exemple_14"></a>20.2. Exemple</h3>
<div class="paragraph">
<p>Nous avons le script de type GlobalLibrary <strong>DocUtils.groovy</strong> ci-dessous :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">public static String getThirdFromList(List&lt;String&gt; list) {
  if(list.size() &gt;= 3) {
    return list.get(2)
  } else {
    return null
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On pourra alors utiliser la méthode <strong>getThirdFromList</strong> dans un autre script de cette façon :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">List&lt;String&gt; list = new ArrayList&lt;&gt;()
list.add("a")
list.add("b")
list.add("c")
list.add("d")
String res = DocUtils.getThirdFromList(List&lt;String&gt; list)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_20_HierarchicalTreeNodeInitializer"><a class="anchor" href="#_20_HierarchicalTreeNodeInitializer"></a>21. HierarchicalTreeNodeInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_19"><a class="anchor" href="#_description_19"></a>21.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé lors de l&#8217;affichage de l&#8217;arborescence dans la vue plan de classement.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_17"><a class="anchor" href="#_paramètres_17"></a>21.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_treeNode</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IHierarchicalTreeNode</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Arbre</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueHierarchicalTreeNodeInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>properties</strong> qui
correspondent aux propriétés de l&#8217;arbre</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_15"><a class="anchor" href="#_exemple_15"></a>21.3. Exemple</h3>
<div class="paragraph">
<p>Personnalisation des icônes des nœuds de l&#8217;arborescence et ajout du déploiement intégral de l&#8217;arbre.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueHierarchicalTreeNodeInitializer.TreeNodeProperty

_result.getProperties().put(TreeNodeProperty.EXPANDED, "true")
_result.getProperties().put(TreeNodeProperty.ICON_FOLDER, "/ui/common/img/dossier_logo.svg")
_result.getProperties().put(TreeNodeProperty.ICON_LEAF, "/ui/common/img/alert_fatal.svg")</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;affichage du plan de classement (sans script)</div>
<p><span class="image"><img src="images/examples/hierarchical_tree_node_initializer_example_without_script.png" alt="hierarchical tree node initializer example without script"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple de personnalisation de l&#8217;affichage du plan de classement (avec script)</div>
<p><span class="image"><img src="images/examples/hierarchical_tree_node_initializer_example_with_script.png" alt="hierarchical tree node initializer example with script"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_21_Task"><a class="anchor" href="#_21_Task"></a>22. Task</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_20"><a class="anchor" href="#_description_20"></a>22.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé afin de décrire l&#8217;exécution d&#8217;une tâche.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_18"><a class="anchor" href="#_paramètres_18"></a>22.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_flowCodes</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;String&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flow codes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parameterMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres de la tâche</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_16"><a class="anchor" href="#_exemple_16"></a>22.3. Exemple</h3>
<div class="paragraph">
<p>On peut passer un paramètre dans la configuration de la tâche (fichier <strong>task.xml</strong>) de cette façon :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;parameter name="param" type="STRING" value="machin"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Et ainsi récupérer ce paramètre dans le script afin de l&#8217;utiliser lorsque la tâche s&#8217;exécute :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.impl.Parameter

Parameter param = _parameterMap?.get("param") as Parameter
String res = param?.getValue()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_22_WSAttachmentInitializer"><a class="anchor" href="#_22_WSAttachmentInitializer"></a>23. WSAttachmentInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_21"><a class="anchor" href="#_description_21"></a>23.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé lors de l&#8217;exécution des webservices sur les pièces jointes (ajout ou mise à jour).</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_19"><a class="anchor" href="#_paramètres_19"></a>23.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Doc ID</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attData</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IWSAttachmentUpdateType</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Attachment data</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_mode</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ScriptModeRun</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>*com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument<strong> 2+</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>secretLevel</strong>, <strong>codeFieldValues</strong>, <strong>ctxValues</strong>
et <strong>document</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_17"><a class="anchor" href="#_exemple_17"></a>23.3. Exemple</h3>
<div class="paragraph">
<p>Arrêt du chargement d&#8217;une pièce jointe si l&#8217;attribut <strong>label</strong> n&#8217;a pas été renseigné dans la requête.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-curl hljs" data-lang="curl">curl --location 'http://localhost:7373/dossierweb/rest/attachment/9097' \
  --header 'Authorization: Basic &lt;credencials&gt;' \
  --form 'attachmentData="{
      \"scriptCode\": \"test\"
  }";type=application/json'
  --form 'fileData=@"/path/document.docx"'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument
import com.digitech.dossier.webservices.type.WSAttachmentUpdateType

WSAttachmentUpdateType att = _attData
if(att.getLabel() == null) {
  _result.fillKOResult("Empty label")
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_23_WSDocumentInitializer"><a class="anchor" href="#_23_WSDocumentInitializer"></a>24. WSDocumentInitializer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_22"><a class="anchor" href="#_description_22"></a>24.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé lors de l&#8217;exécution des webservices sur les documents (ajout ou mise à jour).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Information"></i>
</td>
<td class="content">
<div class="paragraph">
<p>À la fois disponible pour le <code><span style="color:#0099ff">Web Service</span></code> <strong>WSDocument</strong> et <strong>WSExtendDocument</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_20"><a class="anchor" href="#_paramètres_20"></a>24.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>_docType</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>WSDocument</strong>: <strong>com.digitech.dossier.webservices.ws.document.type.WSDocumentType</strong></p>
</li>
<li>
<p><strong>WSExtendDocument</strong>: <strong>com.digitech.dossier.webservices.extend.type.WSDocumentType</strong> ou</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>document structure</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parentDocType</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.webservices.extend.type.WSDocumentType</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>parent document structure (si disponible, <strong>WSExtendDocument</strong> seulement)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>_mode</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ScriptModeRun</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Sortie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>secretLevel</strong>, <strong>codeFieldValues</strong>, <strong>ctxValues</strong>
et <strong>document</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_18"><a class="anchor" href="#_exemple_18"></a>24.3. Exemple</h3>
<div class="paragraph">
<p>Ajout de commentaire dans le champ <strong>CR_RESUME</strong> si le document est mis à jour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IDocument
import com.digitech.dossier.script.model.impl.result.ScriptModeRun
import com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument
import java.text.SimpleDateFormat

def today = new Date()
def sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss")
if (_mode == ScriptModeRun.UPDATE) {
  IDocument doc = _document as IDocument
  String resume = doc.getField("CR_RESUME").getAirsValue()
  String newResume = resume + "\n" + "Mis à jour le " + sdf.format(today)
  _result.addFieldValue("CR_RESUME", newResume)
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;ajout de commentaire dans le champ Résumé lors de la mise à jour d&#8217;un document</div>
<p><span class="image"><img src="images/examples/ws_document_initializer_example.png" alt="ws document initializer example"></span></p>
</div>
</div>
</div>
</div>
</div>
<script src="highlightjs/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/javascript" src="tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="tools/codeTools.js"></script>
<script type="text/javascript" src="tools/tabs.js"></script>
<script type="text/javascript" src="tools/switchTheme.js"></script>
<script type="text/javascript">

  function initTabsAndTheme() {
    buildTabs();
    initTheme();
  }

  /* Tocbot dynamic TOC, works with tocbot 4.0.x */
  try {
    tocbot.init({
      contentSelector: '#content',
      headingSelector: 'h1, h2, h3, h4, h5',
      smoothScroll: true,
      headingsOffset: 40,
      scrollSmoothOffset: -40,
      orderedList: false
    });

    let oldtoc = document.getElementById('toctitle').nextElementSibling;
    const newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);

    const handleTocOnResize = function () {
      const width = window.innerWidth
          || document.documentElement.clientWidth
          || document.body.clientWidth;
      if (width < 768) {
        tocbot.refresh({
          contentSelector: '#content',
          headingSelector: 'h1, h2, h3, h4, h5',
          collapseDepth: 6,
          activeLinkClass: 'ignoreactive',
          throttleTimeout: 1000,
          smoothScroll: false
        });
      } else {
        tocbot.refresh({
          contentSelector: '#content',
          headingSelector: 'h1, h2, h3, h4, h5',
          smoothScroll:  true,
          headingsOffset: 40,
          scrollSmoothOffset: -40,
          orderedList: false
        });
      }
    };

    addCodeToolElements();
    switchInitialTheme();
    handleTocOnResize();
    window.addEventListener('resize', handleTocOnResize);
    window.addEventListener("load", initTabsAndTheme());
  }
  catch(err) {}


</script>
</body>
</html>