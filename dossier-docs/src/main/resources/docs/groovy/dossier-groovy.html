<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Digitech">
<link rel="icon" type="image/png" href="images/icons/arcade_favicon-32x32.png">
<title>Personnalisation de l&#8217;application Arcade GED à l&#8217;aide de scripts Groovy</title>
<link rel="stylesheet" href="css/digitech.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="highlightjs/styles/github.min.css">
<!--
<meta name="theme-color" content="#319197" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#872e4e" media="(prefers-color-scheme: dark)">
-->
<script src="echarts/echarts.min.js"></script>
<script src="js/setup.js"></script><script defer src="js/site.js"></script>

</head>
<body id="Dossier-groovy" class="book toc2 toc-left">
<div id="banner-container" class="container" role="banner">
    <div id="banner" class="contained" role="banner">
        <div id="switch-theme">
            <input type="checkbox" id="switch-theme-checkbox"/>
            <label for="switch-theme-checkbox">Dark Theme</label>
        </div>
    </div>
</div>
<div id="header">
<h1>Personnalisation de l&#8217;application <code><span style="color:#448279">Arcade GED</span></code> à l&#8217;aide de scripts Groovy</h1>
<div class="details">
<span id="author" class="author">Digitech</span><br>
<span id="revnumber">version 1.1,</span>
<span id="revdate">16/05/2025 16:42:14</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Sommaire</div>
<ul class="sectlevel1">
<li><a href="#_01_intro">1. Introduction</a></li>
<li><a href="#_01_Which_scripts">2. Quel script pour quelle action ?</a></li>
<li><a href="#_01_CommonData">3. Données communes à chaque script</a></li>
<li><a href="#_02_AttachmentDisplaySorting">4. <code><span style="color:#11da73">AttachmentDisplaySorting</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description">4.1. Description</a></li>
<li><a href="#_paramètres">4.2. Paramètres</a></li>
<li><a href="#_sample">4.3. Sample</a></li>
</ul>
</li>
<li><a href="#_03_AttachmentInitializer">5. <code><span style="color:#11da73">AttachmentInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_2">5.1. Description</a></li>
<li><a href="#_paramètres_2">5.2. Paramètres</a></li>
<li><a href="#_sample_2">5.3. Sample</a></li>
</ul>
</li>
<li><a href="#_04_AttachmentTableSorting">6. <code><span style="color:#11da73">AttachmentTableSorting</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_3">6.1. Description</a></li>
<li><a href="#_paramètres_3">6.2. Paramètres</a></li>
<li><a href="#_exemple">6.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_05_AttachmentUploaded">7. <code><span style="color:#11da73">AttachmentUploaded</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_4">7.1. Description</a></li>
<li><a href="#_paramètres_4">7.2. Paramètres</a></li>
<li><a href="#_exemple_2">7.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_06_BasketInitializer">8. <code><span style="color:#11da73">BasketInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_5">8.1. Description</a></li>
<li><a href="#_paramètres_5">8.2. Paramètres</a></li>
<li><a href="#_exemple_3">8.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_07_ConnectorPropertiesInitializer">9. <code><span style="color:#11da73">ConnectorPropertiesInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_6">9.1. Description</a></li>
<li><a href="#_paramètres_6">9.2. Paramètres</a></li>
<li><a href="#_sample_3">9.3. Sample</a></li>
</ul>
</li>
<li><a href="#_08_CustomHomeBlock">10. <code><span style="color:#11da73">CustomHomeBlock</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_7">10.1. Description</a></li>
<li><a href="#_paramètres_7">10.2. Paramètres</a></li>
<li><a href="#_exemple_4">10.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_09_DisplayRule">11. <code><span style="color:#11da73">DisplayRule</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_8">11.1. Description</a></li>
<li><a href="#_paramètres_8">11.2. Paramètres</a></li>
<li><a href="#_exemple_5">11.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_10_DocCreation">12. <code><span style="color:#11da73">DocCreation</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_9">12.1. Description</a></li>
<li><a href="#_paramètres_9">12.2. Paramètres</a></li>
<li><a href="#_exemple_6">12.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_11_DocumentActions">13. <code><span style="color:#11da73">DocumentActions</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_10">13.1. Description</a></li>
<li><a href="#_paramètres_10">13.2. Paramètres</a></li>
<li><a href="#_exemple_7">13.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_12_DocumentChecker">14. <code><span style="color:#11da73">DocumentChecker</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_11">14.1. Description</a></li>
<li><a href="#_paramètres_11">14.2. Paramètres</a></li>
<li><a href="#_exemples">14.3. Exemples</a></li>
</ul>
</li>
<li><a href="#_13_DocumentInitializer">15. <code><span style="color:#11da73">DocumentInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_12">15.1. Description</a></li>
<li><a href="#_paramètres_12">15.2. Paramètres</a></li>
<li><a href="#_exemple_8">15.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_14_ElementFilter">16. <code><span style="color:#11da73">ElementFilter</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_13">16.1. Description</a></li>
<li><a href="#_paramètres_13">16.2. Paramètres</a></li>
<li><a href="#_exemple_9">16.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_15_ExportInitializer">17. <code><span style="color:#11da73">ExportInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_14">17.1. Description</a></li>
<li><a href="#_paramètres_14">17.2. Paramètres</a></li>
<li><a href="#_exemple_10">17.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_16_ExternalScript">18. <code><span style="color:#11da73">ExternalScript</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_15">18.1. Description</a></li>
<li><a href="#_exemple_11">18.2. Exemple</a></li>
</ul>
</li>
<li><a href="#_17_FieldDependency">19. <code><span style="color:#11da73">FieldDependency</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_16">19.1. Description</a></li>
<li><a href="#_paramètres_15">19.2. Paramètres</a></li>
<li><a href="#_exemple_12">19.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_18_FieldInitializer">20. <code><span style="color:#11da73">FieldInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_17">20.1. Description</a></li>
<li><a href="#_paramètres_16">20.2. Paramètres</a></li>
<li><a href="#_exemple_13">20.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_19_GlobalLibrary">21. <code><span style="color:#11da73">GlobalLibrary</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_18">21.1. Description</a></li>
<li><a href="#_exemple_14">21.2. Exemple</a></li>
</ul>
</li>
<li><a href="#_20_GlobalSearch">22. <code><span style="color:#11da73">GlobalSearch</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_19">22.1. Description</a></li>
<li><a href="#_paramètres_17">22.2. Paramètres</a></li>
<li><a href="#_exemple_15">22.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_19_FullTextSearch">23. <code><span style="color:#11da73">FullTextSearch</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_20">23.1. Description</a></li>
<li><a href="#_paramètres_18">23.2. Paramètres</a></li>
<li><a href="#_exemples_2">23.3. Exemples</a></li>
</ul>
</li>
<li><a href="#_21_HierarchicalTreeNodeInitializer">24. <code><span style="color:#11da73">HierarchicalTreeNodeInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_21">24.1. Description</a></li>
<li><a href="#_paramètres_19">24.2. Paramètres</a></li>
<li><a href="#_exemple_16">24.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_22_Task">25. <code><span style="color:#11da73">Task</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_22">25.1. Description</a></li>
<li><a href="#_paramètres_20">25.2. Paramètres</a></li>
<li><a href="#_exemple_17">25.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_23_WSAttachmentInitializer">26. <code><span style="color:#11da73">WSAttachmentInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_23">26.1. Description</a></li>
<li><a href="#_paramètres_21">26.2. Paramètres</a></li>
<li><a href="#_exemple_18">26.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_24_WSDocumentInitializer">27. <code><span style="color:#11da73">WSDocumentInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_24">27.1. Description</a></li>
<li><a href="#_paramètres_22">27.2. Paramètres</a></li>
<li><a href="#_exemple_19">27.3. Exemple</a></li>
</ul>
</li>
<li><a href="#_24_WSExtendDocumentInitializer">28. <code><span style="color:#11da73">WSExtendDocumentInitializer</span></code></a>
<ul class="sectlevel2">
<li><a href="#_description_25">28.1. Description</a></li>
<li><a href="#_paramètres_23">28.2. Paramètres</a></li>
</ul>
</li>
<li><a href="#_99_appendixes">29. Annexes</a>
<ul class="sectlevel2">
<li><a href="#_99_appendixes_groovy">29.1. <code><span style="color:#2C8470">Groovy</span></code> Bonnes pratiques, astuces, &#8230;&#8203;</a>
<ul class="sectlevel3">
<li><a href="#_99_appendixes_groovy_conventions">29.1.1. <code><span style="color:#448279">Arcade GED</span></code>/<code><span style="color:#2C8470">Groovy</span></code> conventions.</a></li>
<li><a href="#_99_appendixes_groovy_elvis">29.1.2. Opérateur <strong>elvis</strong></a></li>
<li><a href="#_99_appendixes_groovy_safeop">29.1.3. Opérateur de navigation <em>"sécurisé"</em></a></li>
<li><a href="#_99_appendixes_groovy_scope">29.1.4. Portée des variables</a></li>
<li><a href="#_99_appendixes_groovy_string_interpolation">29.1.5. Substitution dans les chaines de caractères</a></li>
</ul>
</li>
<li><a href="#_99_appendixes_utils">29.2. Méthodes <code><span style="color:#448279">Arcade GED</span></code> utiles</a>
<ul class="sectlevel3">
<li><a href="#_99_appendixes_utils_conf">29.2.1. Répertoires de configuration</a></li>
<li><a href="#_99_appendixes_utils_script_init">29.2.2. Initialisation/Finalisation de script <code><span style="color:#2C8470">Groovy</span></code></a></li>
<li><a href="#_99_appendixes_utils_cache">29.2.3. Cache</a></li>
<li><a href="#_99_appendixes_utils_properties">29.2.4. Lecture d&#8217;un fichier <strong>properties</strong></a></li>
<li><a href="#_99_appendixes_utils_json_parser">29.2.5. Lecture d&#8217;un flux <strong>JSON</strong></a></li>
<li><a href="#_99_appendixes_utils_dbpool">29.2.6. Pool de connections à une base de données</a></li>
<li><a href="#_99_appendixes_utils_sql">29.2.7. Récupération de données en base de données</a></li>
<li><a href="#_99_appendixes_utils_output_msg">29.2.8. Affichage d&#8217;un message en fin de traitement</a></li>
<li><a href="#_99_appendixes_utils_services">29.2.9. Accès aux services communs d'<code><span style="color:#448279">Arcade GED</span></code></a></li>
</ul>
</li>
<li><a href="#_99_appendixes_samples">29.3. Quelques exemples</a>
<ul class="sectlevel3">
<li><a href="#_99_samples_displayRule_1">29.3.1. <strong><code><span style="color:#11da73">DisplayRule</span></code></strong> Rendre visible une <strong class="yellow"><em>action custom</em></strong> si une pièce jointe est disponible</a></li>
<li><a href="#_99_samples_DocumentInitializer_1">29.3.2. <strong><code><span style="color:#11da73">DocumentInitializer</span></code></strong> script sur déclenchement d&#8217;une <strong class="yellow"><em>action custom</em></strong></a></li>
<li><a href="#_autres_exemplesfichiers_divers">29.3.3. Autres exemples/fichiers divers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/arcade-cover.png" alt="arcade cover">
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch tableBorder stripes-none">
<colgroup>
<col style="width: 37.5%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock text-left filtered max-width-400 m-auto">
<div class="content">
<img src="images/icons/digitech_logo_and_text.svg" alt="digitech logo and text">
</div>
</div></div></td>
<td class="tableblock halign-left valign-bottom" rowspan="2"><div class="content"><div class="paragraph">
<p><code>Digitech SA</code><br>
<em>ZAC Saumaty Séon - 21 av. Fernand Sardou - CS 40173<br>
13322 Marseille Cedex 16</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Copyright (c) 2025 <code>Digitech SA</code>, tous droits réservés.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Table 1. Notes de suivi</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">État</th>
<th class="tableblock halign-left valign-top">Objet</th>
<th class="tableblock halign-left valign-top">Rédacteur</th>
<th class="tableblock halign-left valign-top">Validateur</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">02/08/2024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Création du document</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="res">MRA</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="res">NFE</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14/02/2025</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validé</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ajout d&#8217;exemples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="res">NFE</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_01_intro"><a class="anchor" href="#_01_intro"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ce document décrit les différents scripts <code><span style="color:#2C8470">Groovy</span></code> permettant la personnalisation d&#8217;Arcade GED.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_01_Which_scripts"><a class="anchor" href="#_01_Which_scripts"></a>2. Quel script pour quelle action ?</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Astuce"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Le nombre de types de scripts étant important, il peut paraître difficile de détecter quel type de script s&#8217;applique dans quel cas.<br>
Ce chapitre permet d&#8217;identifier rapidement les cas d&#8217;utilisation.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action souhaitée</th>
<th class="tableblock halign-left valign-top">Type de Script</th>
<th class="tableblock halign-left valign-top">Observation</th>
</tr>
</thead>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_01_CommonData"><a class="anchor" href="#_01_CommonData"></a>3. Données communes à chaque script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;ensemble des scripts décrit dans les chapitres suivants contiennent les 2 paramètres suivants :</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 57.1429%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_scriptLogger</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>org.log4j.Logger</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Logger par défaut pour inscrire des informations dans les fichiers de <strong>logs</strong>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_userContext</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.common.model.IUserCoreContext</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Informations relatives à l&#8217;utilisateur exécutant le script.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_output</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.IScriptResultModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>Généralement</em> non utilisé directement dans les scripts.<br>
La variable suivante <strong>_result</strong> semble convenir à la plupart des cas.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.IScriptResultValueModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Structure de retour. Voir pour chaque script la liste des attributs disponibles.<br>
Les attributs communs sont :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>status</strong> : de type <strong>com.digitech.common.script.model.EnumScriptStatus</strong></p>
</li>
<li>
<p><strong>messageSeverity</strong> : de type <strong>com.digitech.dossier.script.model.IScriptResultValueModel#Severity</strong></p>
</li>
<li>
<p><strong>messageSummary</strong> : message si nécessaire</p>
</li>
<li>
<p><strong>messageDetail</strong> : message détaillé si nécessaire</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_02_AttachmentDisplaySorting"><a class="anchor" href="#_02_AttachmentDisplaySorting"></a>4. <code><span style="color:#11da73">AttachmentDisplaySorting</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description"><a class="anchor" href="#_description"></a>4.1. Description</h3>
<div class="paragraph">
<p>Ce script permet de définir quelle pièce jointe est affichée <em>par défaut</em> en vue hiérarchique.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres"><a class="anchor" href="#_paramètres"></a>4.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ID du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachmentList</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IAttachment&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des pièces jointes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueAttachmentToDisplay</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>document</strong> et <strong>attachment</strong>
correspondant au document et sa pièce jointe à afficher</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_sample"><a class="anchor" href="#_sample"></a>4.3. Sample</h3>
<div class="paragraph">
<p>Tri de la liste des pièces jointes par ordre alphabétique.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.impl.comparator.AttachmentComparator
import org.apache.commons.collections4.CollectionUtils

if(CollectionUtils.isNotEmpty(_attachmentList)) {
  _result.attachment = _attachmentList.get(0)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_03_AttachmentInitializer"><a class="anchor" href="#_03_AttachmentInitializer"></a>5. <code><span style="color:#11da73">AttachmentInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_2"><a class="anchor" href="#_description_2"></a>5.1. Description</h3>
<div class="paragraph">
<p><em>à documenter</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_2"><a class="anchor" href="#_paramètres_2"></a>5.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ID du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueChecker</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>valid</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_sample_2"><a class="anchor" href="#_sample_2"></a>5.3. Sample</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_04_AttachmentTableSorting"><a class="anchor" href="#_04_AttachmentTableSorting"></a>6. <code><span style="color:#11da73">AttachmentTableSorting</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_3"><a class="anchor" href="#_description_3"></a>6.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé lors de la récupération des pièces jointes d&#8217;un document, afin de les trier avant de les afficher.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_3"><a class="anchor" href="#_paramètres_3"></a>6.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ID du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachmentList</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IAttachment&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des pièces jointes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueAttachmentToDisplay</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>document</strong> et <strong>attachment</strong>
correspondant au document et sa pièce jointe à afficher</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple"><a class="anchor" href="#_exemple"></a>6.3. Exemple</h3>
<div class="paragraph">
<p>Tri de la liste des pièces jointes par ordre alphabétique.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.impl.comparator.AttachmentComparator
import org.apache.commons.collections4.CollectionUtils

if(CollectionUtils.isNotEmpty(_attachmentList)) {
  _attachmentList.sort(AttachmentComparator.ATT_LABEL_COMP)
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;affichage d&#8217;une liste de pièces jointes triées par ordre alphabétique</div>
<p><span class="image"><img src="images/examples/attachment_table_sorting_example.png" alt="attachment table sorting example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_05_AttachmentUploaded"><a class="anchor" href="#_05_AttachmentUploaded"></a>7. <code><span style="color:#11da73">AttachmentUploaded</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_4"><a class="anchor" href="#_description_4"></a>7.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé lorsque l&#8217;on dépose ou supprime une pièce jointe.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_4"><a class="anchor" href="#_paramètres_4"></a>7.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_mode</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>AttachmentUploadEventMode</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode (ajout/suppression)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.SimpleScriptResultModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>--</em></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_2"><a class="anchor" href="#_exemple_2"></a>7.3. Exemple</h3>
<div class="paragraph">
<p>Remplissage du champ <em>Désignation</em> lors de la création d&#8217;un compte-rendu via le dépôt de pièce jointe depuis la page d&#8217;accueil.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.FieldUtils
import com.digitech.dossier.script.model.impl.typedef.AttachmentUploadEventMode

des = FieldUtils.getValue(_document, "CR_DES")

if(_mode == AttachmentUploadEventMode.REMOVE) {
  if(_attachment?.fileName == des) {
    FieldUtils.setValue(_document, "CR_DES", null)
  }
}
else {
  if(des == null) {
    FieldUtils.setValue(_document, "CR_DES", _attachment?.fileName)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de création de compte-rendu avec pièce jointe</div>
<p><span class="image"><img src="images/examples/attachment_uploaded_example.png" alt="attachment uploaded example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_06_BasketInitializer"><a class="anchor" href="#_06_BasketInitializer"></a>8. <code><span style="color:#11da73">BasketInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_5"><a class="anchor" href="#_description_5"></a>8.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé pour initialiser les bannettes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_5"><a class="anchor" href="#_paramètres_5"></a>8.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_basket</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IBasketModel</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Bannette</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueBasketInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>properties</strong> qui contient les propriétés
de la bannette</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_3"><a class="anchor" href="#_exemple_3"></a>8.3. Exemple</h3>
<div class="paragraph">
<p>Masquer les bannettes ne contenant aucun document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueBasketInitializer

if(_basket.getResultNumber(_userContext) == 0) {
  _result.getProperties().put(ScriptResultValueBasketInitializer.BasketProperty.DISPLAYED, "false")
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de liste des bannettes (sans script)</div>
<p><span class="image"><img src="images/examples/basket_initializer_example_without_script.png" alt="basket initializer example without script"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple de liste des bannettes (avec script)</div>
<p><span class="image"><img src="images/examples/basket_initializer_example_with_script.png" alt="basket initializer example with script"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_07_ConnectorPropertiesInitializer"><a class="anchor" href="#_07_ConnectorPropertiesInitializer"></a>9. <code><span style="color:#11da73">ConnectorPropertiesInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_6"><a class="anchor" href="#_description_6"></a>9.1. Description</h3>
<div class="paragraph">
<p><em>à documenter</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_6"><a class="anchor" href="#_paramètres_6"></a>9.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_flowModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flow code</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueConnectorRule</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>annexeDocument</strong>: liste de <strong>IAttachment</strong></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_sample_3"><a class="anchor" href="#_sample_3"></a>9.3. Sample</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_08_CustomHomeBlock"><a class="anchor" href="#_08_CustomHomeBlock"></a>10. <code><span style="color:#11da73">CustomHomeBlock</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_7"><a class="anchor" href="#_description_7"></a>10.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé pour l&#8217;affichage des blocs personnalisables de l&#8217;écran d&#8217;accueil</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_7"><a class="anchor" href="#_paramètres_7"></a>10.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parameterMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.CustomBlockScriptResultModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les propriétés du bloc</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_4"><a class="anchor" href="#_exemple_4"></a>10.3. Exemple</h3>
<div class="paragraph">
<p>Personnalisation du style de l&#8217;entête avec un aspect de sous-titre ("h2").</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">_model.setHeaderStyleClass("h2")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_09_DisplayRule"><a class="anchor" href="#_09_DisplayRule"></a>11. <code><span style="color:#11da73">DisplayRule</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_8"><a class="anchor" href="#_description_8"></a>11.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est déclenché pour l&#8217;affichage des actions personnalisées.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_8"><a class="anchor" href="#_paramètres_8"></a>11.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachment</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IAttachment</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pièce jointe</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueDisplayRule</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>valid</strong> qui détermine l&#8217;affichage de l&#8217;action</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_5"><a class="anchor" href="#_exemple_5"></a>11.3. Exemple</h3>
<div class="paragraph">
<p>Affichage de l&#8217;action "Diffuser le CR à Digitech !" si le document contient des pièces jointes et que le champ <em>Thématique</em> contient la valeur <em>Réunion
transverse</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IDocument
import com.digitech.dossier.common.service.IAuthorityList
import com.digitech.dossier.common.service.ServiceManager
import com.digitech.jcorbairs.Term

Term updatedFieldCode = getAuthorityListService().getTerm((Integer) document.getField("CR_THEME").getValue())
_result.setValid(_document?.getAttachments(_userContext)?.size &gt; 0 &amp;&amp; updatedFieldCode?.getCode() == "TH_TRANS")

/**
 * @return IAuthorityList the Authority List
 */
public static IAuthorityList getAuthorityListService() {
  return (IAuthorityList) ServiceManager.getInstance().getService(com.digitech.dossier.common.service.Constants.SERVICE_AIRS_AUTHORITYLIST_MGR
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;affichage de l&#8217;action</div>
<p><span class="image"><img src="images/examples/display_rule_example_displayed.png" alt="display rule example displayed"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple où l&#8217;action est masquée</div>
<p><span class="image"><img src="images/examples/display_rule_example_hidden.png" alt="display rule example hidden"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_10_DocCreation"><a class="anchor" href="#_10_DocCreation"></a>12. <code><span style="color:#11da73">DocCreation</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_9"><a class="anchor" href="#_description_9"></a>12.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lors de la création d&#8217;un document, afin de préremplir les données du formulaire.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_9"><a class="anchor" href="#_paramètres_9"></a>12.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_updateFields</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Collection&lt;UpdateField&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Champs du document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attachmentList</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IAttachment&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des pièces jointes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultDocCreationInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>updatedFields</strong> définissant les champs
affichés</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_6"><a class="anchor" href="#_exemple_6"></a>12.3. Exemple</h3>
<div class="paragraph">
<p>Ajout de l&#8217;utilisateur courant en tant que rédacteur et de la date du jour lorsque l&#8217;on accède à la page de création d&#8217;un document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IDocument
import java.time.LocalDate
import java.time.format.DateTimeFormatter
import com.digitech.dossier.common.utils.FieldUtils
import com.digitech.dossier.common.model.backend.params.UpdateField

def today = LocalDate.now().format(DateTimeFormatter.ofPattern("dd/MM/yyyy"))
UpdateField uf = _updateFields.get('CR_DATE')
if(uf != null) {
  FieldUtils.setValue(_document as IDocument, 'CR_DATE', today)
}
uf = _updateFields.get('CR_REDACTEUR')
if(uf != null) {
 FieldUtils.setValue(_document as IDocument, 'CR_REDACTEUR', _userContext.getUserId())
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de création d&#8217;un Compte rendu</div>
<p><span class="image"><img src="images/examples/doc_creation_example.png" alt="doc creation example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_11_DocumentActions"><a class="anchor" href="#_11_DocumentActions"></a>13. <code><span style="color:#11da73">DocumentActions</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_10"><a class="anchor" href="#_description_10"></a>13.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé lors de la récupération des actions pour un document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_10"><a class="anchor" href="#_paramètres_10"></a>13.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_fieldValueMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, IFieldValue&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des champs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>allActions</strong> (toutes les actions) et
<strong>unavailableActions</strong> (actions indisponibles)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_7"><a class="anchor" href="#_exemple_7"></a>13.3. Exemple</h3>
<div class="paragraph">
<p>Ajout de l&#8217;interdiction d&#8217;effectuer l&#8217;action <strong>Verrouiller</strong> pour un utilisateur n&#8217;ayant pas le profil <em>DOC_ADMIN_CLIENT</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IFieldValue
import com.digitech.dossier.common.utils.UserUtils
import com.digitech.dossier.script.model.impl.result.ScriptResultModel
import com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions

List&lt;ScriptResultValueDocumentActions.Action&gt; unavailableActions = new ArrayList&lt;ScriptResultValueDocumentActions.Action&gt;()
if(!UserUtils.hasProfile(_userContext, "DOS_ADMIN_CLIENT")) {
  unavailableActions.add(ScriptResultValueDocumentActions.Action.LOCK)
}
_result.getUnavailableActions().addAll(unavailableActions)</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de résultats de recherche pour un utilisateur n&#8217;ayant pas le droit de verrouiller les documents</div>
<p><span class="image"><img src="images/examples/document_actions_example.png" alt="document actions example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_12_DocumentChecker"><a class="anchor" href="#_12_DocumentChecker"></a>14. <code><span style="color:#11da73">DocumentChecker</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_11"><a class="anchor" href="#_description_11"></a>14.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé avant une recherche pour valider les critères.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_11"><a class="anchor" href="#_paramètres_11"></a>14.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_search</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ISearchModel</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Recherche</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>-parameters</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueChecker</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>valid</strong> qui détermine si la recherche est valide</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemples"><a class="anchor" href="#_exemples"></a>14.3. Exemples</h3>
<div class="listingblock">
<div class="title">Blocage d&#8217;une recherche si une certaine condition est rencontrée.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">boolean condition = checkIfSearchIsValid(_search)
result.setValid(condition)

private static boolean checkIfSearchIsValid(def sm) {
  //
  return ok
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ajout d&#8217;un critère de recherche</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">if(!userCanSeeArchiveFolder(_userContext)) {
  _search.setAirsRequest(_search.getAirsRequest(_userContext)) + " ET ARCHIVE=0"
}

private static boolean userCanSeeArchiveFolder(IUserCoreContext uc) {
  // whatever...
  return uc.getProfileCodeList().contains("ARCHIVE_RIGHT")
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_13_DocumentInitializer"><a class="anchor" href="#_13_DocumentInitializer"></a>15. <code><span style="color:#11da73">DocumentInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_12"><a class="anchor" href="#_description_12"></a>15.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est déclenché lorsqu&#8217;une action personnalisée est lancée ou lors d&#8217;un export.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_12"><a class="anchor" href="#_paramètres_12"></a>15.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_customModel</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>CustomActionModel</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>CustomActionModel</strong> rattachée au script</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_airsDocument</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="red-bg">déprécié</span>, utiliser la variable <strong>_document</strong> svp</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>documentList</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_8"><a class="anchor" href="#_exemple_8"></a>15.3. Exemple</h3>
<div class="paragraph">
<p>Affichage d&#8217;un message à la fin d&#8217;une action personnalisée.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentInitializer
import com.digitech.dossier.script.model.IScriptResultValueModel.Severity

_result.setMessageSeverity(Severity.INFO)
_result.setMessageSummary("Action personnalisée sur le document '" + _document?.getAirsRefId() + "'")</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de message</div>
<p><span class="image"><img src="images/examples/document_initializer_example.png" alt="document initializer example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_14_ElementFilter"><a class="anchor" href="#_14_ElementFilter"></a>16. <code><span style="color:#11da73">ElementFilter</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_13"><a class="anchor" href="#_description_13"></a>16.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé pour filtrer les listes d&#8217;éléments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_13"><a class="anchor" href="#_paramètres_13"></a>16.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_users</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;?&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des utilisateurs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_elements</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;?&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des éléments</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;?&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Variable <strong>_elements</strong> qui correspond à la liste des éléments en sortie</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_9"><a class="anchor" href="#_exemple_9"></a>16.3. Exemple</h3>
<div class="paragraph">
<p>Filtrage sur une liste d&#8217;utilisateurs : affichage des personnes dont le nom de famille commence par un "D".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.UserUtils
import com.digitech.jcorbairs.User

List&lt;User&gt; filteredList = _users.findAll({it.getLastName().startsWith("D")})
_elements.clear()
_elements.addAll(filteredList)</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de filtre sur une liste d&#8217;utilisateurs</div>
<p><span class="image"><img src="images/examples/element_filter_example.png" alt="element filter example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_15_ExportInitializer"><a class="anchor" href="#_15_ExportInitializer"></a>17. <code><span style="color:#11da73">ExportInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_14"><a class="anchor" href="#_description_14"></a>17.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lorsqu&#8217;un export est lancé.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_14"><a class="anchor" href="#_paramètres_14"></a>17.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_documents</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IDocument&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste de documents à exporter</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueExportInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>fileResultPath</strong> et <strong>fileResultName</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_10"><a class="anchor" href="#_exemple_10"></a>17.3. Exemple</h3>
<div class="paragraph">
<p>Définition des variables <strong>fileResultPath</strong> et <strong>fileResultName</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">_result.setFileResultPath("fileResultPath")
_result.setFileResultName("fileResultName")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_16_ExternalScript"><a class="anchor" href="#_16_ExternalScript"></a>18. <code><span style="color:#11da73">ExternalScript</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_15"><a class="anchor" href="#_description_15"></a>18.1. Description</h3>
<div class="paragraph">
<p>Ce type de script n&#8217;est pas directement géré par Dossier (librairies externes).</p>
</div>
</div>
<div class="sect2">
<h3 id="_exemple_11"><a class="anchor" href="#_exemple_11"></a>18.2. Exemple</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_17_FieldDependency"><a class="anchor" href="#_17_FieldDependency"></a>19. <code><span style="color:#11da73">FieldDependency</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_16"><a class="anchor" href="#_description_16"></a>19.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lorsque l&#8217;on souhaite avoir une dépendance entre les valeurs de certains champs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_15"><a class="anchor" href="#_paramètres_15"></a>19.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_fieldToUpdate</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IField</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Champ à mettre à jour</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_fieldMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, IField&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des champs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_updatedField</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IField</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Champ que l&#8217;on modifie</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_updateFieldValues</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Object</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parameterMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;IParameter&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.IScriptResultModel&lt;T&gt;</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_12"><a class="anchor" href="#_exemple_12"></a>19.3. Exemple</h3>
<div class="paragraph">
<p>Modification de la liste des choix pour le champ <em>Plan de classement</em> lorsque la valeur du champ <em>Catégorie de document</em> est modifiée.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">List&lt;SelectItem&gt; selectItems = new SelectItemFactory().getAuthorities(_fieldToUpdate.getConfigField());
Term updatedFieldCode = getAuthorityListService().getTerm((Integer) _updatedField.getValue())

List&lt;SelectItem&gt; test = new ArrayList&lt;&gt;();
for(items in selectItems) {
  if(items.getValue() != null) {
    Term code = getAuthorityListService().getTerm((Integer) items.getValue());
    SelectItem item = new SelectItem()
    item.setLabel(code.getValues()[0] as String)
    item.setValue(code.getCode())
    test.add(item)
  }
}
List&lt;SelectItem&gt; filteredList = test.findAll({it.getValue().startsWith(updatedFieldCode.getCode() as String)})
HtmlSelectOneMenu component = ((HtmlSelectOneMenu)  ((UIComponent) _fieldToUpdate.getComponent()));
component.getChildren().get(0).setValue(filteredList);

/**
 * @return IAuthorityList the Authority List
 */
public static IAuthorityList getAuthorityListService() {
  return (IAuthorityList) ServiceManager.getInstance().getService(com.digitech.dossier.common.service.Constants.SERVICE_AIRS_AUTHORITYLIST_MGR);
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de choix pour la catégorie Commerce</div>
<p><span class="image"><img src="images/examples/field_dependency_example_commerce.png" alt="field dependency example commerce"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple de choix pour la catégorie Comptabilité</div>
<p><span class="image"><img src="images/examples/field_dependency_example_compta.png" alt="field dependency example compta"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_18_FieldInitializer"><a class="anchor" href="#_18_FieldInitializer"></a>20. <code><span style="color:#11da73">FieldInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_17"><a class="anchor" href="#_description_17"></a>20.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lors de l&#8217;affichage des champs d&#8217;un document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_16"><a class="anchor" href="#_paramètres_16"></a>20.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_airsDocument</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document Airs</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_document</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IDocument</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Document</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>parameters</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueFieldInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>results</strong>, <strong>properties</strong> et
<strong>validatorAttributs</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_13"><a class="anchor" href="#_exemple_13"></a>20.3. Exemple</h3>
<div class="paragraph">
<p>Affichage des champs <em>CR_REDACTEUR</em> et <em>CR_DATE</em> en lecture seule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueFieldInitializer

if(_updateField.getFieldCode() == "CR_REDACTEUR" || _updateField.getFieldCode() == "CR_DATE") {
  _result.getProperties().put(ScriptResultValueFieldInitializer.FieldProperty.READ_ONLY, "true")
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple de champs en lecture seule lors de la création d&#8217;un compte-rendu</div>
<p><span class="image"><img src="images/examples/field_initializer_example.png" alt="field initializer example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_19_GlobalLibrary"><a class="anchor" href="#_19_GlobalLibrary"></a>21. <code><span style="color:#11da73">GlobalLibrary</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_18"><a class="anchor" href="#_description_18"></a>21.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé pour définir des méthodes qui pourront être utilisées dans d&#8217;autres scripts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exemple_14"><a class="anchor" href="#_exemple_14"></a>21.2. Exemple</h3>
<div class="paragraph">
<p>Nous avons le script de type GlobalLibrary <strong>DocUtils.groovy</strong> ci-dessous :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">public static String getThirdFromList(List&lt;String&gt; list) {
  if(list.size() &gt;= 3) {
    return list.get(2)
  } else {
    return null
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On pourra alors utiliser la méthode <strong>getThirdFromList</strong> dans un autre script de cette façon :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">List&lt;String&gt; list = new ArrayList&lt;&gt;()
list.add("a")
list.add("b")
list.add("c")
list.add("d")
String res = DocUtils.getThirdFromList(List&lt;String&gt; list)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_20_GlobalSearch"><a class="anchor" href="#_20_GlobalSearch"></a>22. <code><span style="color:#11da73">GlobalSearch</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_19"><a class="anchor" href="#_description_19"></a>22.1. Description</h3>
<div class="paragraph">
<p>Ce script est déclenché lors de l&#8217;exécution d&#8217;une recherche dite <em>"rapide"</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_17"><a class="anchor" href="#_paramètres_17"></a>22.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_search</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ISearchModel</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>recherche courante</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_searchPhrase</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Critères de recherche saisis</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ne modifiez pas le paramètre <strong>_searchPhrase</strong>, préférez injecter - si votre action est celle-ci - la nouvelle requête comme il suit :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">_search.setAirsRequest("&lt;new criteria&gt;")</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueChecker</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>valid</strong> qui permet (<em>optionnellement</em>) d&#8217;annuler la
requête</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_15"><a class="anchor" href="#_exemple_15"></a>22.3. Exemple</h3>
<div class="listingblock">
<div class="title">Ajout d&#8217;un critère</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.Constants

if(!_searchCriteria.contains(Constants.FIELD_CODE_D_CREAT)) {
  _search.getAirsRequest() + " ET " + Constants.FIELD_CODE_D_CREAT + "&gt;'01/01/2020'"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Invalidation de la requête</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">if(_searchCriteria.contains("données sensibles")) {
  _result.valid = false
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_19_FullTextSearch"><a class="anchor" href="#_19_FullTextSearch"></a>23. <code><span style="color:#11da73">FullTextSearch</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_20"><a class="anchor" href="#_description_20"></a>23.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé avant une recherche fulltext pour ajouter ou modifier les filtres de recherche.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_18"><a class="anchor" href="#_paramètres_18"></a>23.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_searchPhrase</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>String</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Recherche entrée par l&#8217;utilisateur</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_filter</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IFTFilter</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Filtre</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_contentTypes</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;String&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Liste des types de contenus sélectionnés pour la recherche</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultFullTextSearch</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>valid</strong> qui détermine si la recherche est valide,
ainsi que la variable <strong>searchPhrase</strong> qui peut être modifiée</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemples_2"><a class="anchor" href="#_exemples_2"></a>23.3. Exemples</h3>
<div class="listingblock">
<div class="title">Blocage d&#8217;une recherche si une certaine condition est rencontrée.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">if (_searchPhrase == "blabla") {
  _result.setValid(false)
  _result.fillKOResult("Ce mot est interdit!")
  return
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Complétion d&#8217;une recherche saisie par l&#8217;utilisateur.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">if(_searchPhrase == "digi") {
  _result.setSearchPhrase("digitech")
  _result.fillOKResult("Votre recherche a été modifiée!")
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ajout de critères de recherche</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">String contentType = "CR"

_filter.addFilterValue(contentType, "CR_RESUME", "test")
_filter.addFilterDate(contentType, "D_MODIF", "01/01/2022", ILocutionModel.Operator.OPERATOR_VALUE_GREATER)
_filter.addFilterValueFromList(contentType, "PRO_APP_OS", "WINDOWS")
_filter.addFilterDates(contentType, "D_CREAT", "01/01/2019", "31/12/2019", ILocutionModel.Operator.OPERATOR_VALUE_BETWEEN)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_21_HierarchicalTreeNodeInitializer"><a class="anchor" href="#_21_HierarchicalTreeNodeInitializer"></a>24. <code><span style="color:#11da73">HierarchicalTreeNodeInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_21"><a class="anchor" href="#_description_21"></a>24.1. Description</h3>
<div class="paragraph">
<p>Ce script est utilisé lors de l&#8217;affichage de l&#8217;arborescence dans la vue plan de classement.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_19"><a class="anchor" href="#_paramètres_19"></a>24.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_treeNode</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IHierarchicalTreeNode</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Arbre</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultValueHierarchicalTreeNodeInitializer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient la variable <strong>properties</strong> qui
correspondent aux propriétés de l&#8217;arbre</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_16"><a class="anchor" href="#_exemple_16"></a>24.3. Exemple</h3>
<div class="paragraph">
<p>Personnalisation des icônes des nœuds de l&#8217;arborescence et ajout du déploiement intégral de l&#8217;arbre.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultValueHierarchicalTreeNodeInitializer.TreeNodeProperty

_result.getProperties().put(TreeNodeProperty.EXPANDED, "true")
_result.getProperties().put(TreeNodeProperty.ICON_FOLDER, "/ui/common/img/dossier_logo.svg")
_result.getProperties().put(TreeNodeProperty.ICON_LEAF, "/ui/common/img/alert_fatal.svg")</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;affichage du plan de classement (sans script)</div>
<p><span class="image"><img src="images/examples/hierarchical_tree_node_initializer_example_without_script.png" alt="hierarchical tree node initializer example without script"></span></p>
</div>
<div class="paragraph">
<div class="title">Exemple de personnalisation de l&#8217;affichage du plan de classement (avec script)</div>
<p><span class="image"><img src="images/examples/hierarchical_tree_node_initializer_example_with_script.png" alt="hierarchical tree node initializer example with script"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_22_Task"><a class="anchor" href="#_22_Task"></a>25. <code><span style="color:#11da73">Task</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_22"><a class="anchor" href="#_description_22"></a>25.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé afin de décrire l&#8217;exécution d&#8217;une tâche.</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_20"><a class="anchor" href="#_paramètres_20"></a>25.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_flowCodes</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List&lt;String&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flow codes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parameterMap</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Map&lt;String, Object&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Paramètres de la tâche</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_17"><a class="anchor" href="#_exemple_17"></a>25.3. Exemple</h3>
<div class="paragraph">
<p>On peut passer un paramètre dans la configuration de la tâche (fichier <strong>task.xml</strong>) de cette façon :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;parameter name="param" type="STRING" value="machin"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Et ainsi récupérer ce paramètre dans le script afin de l&#8217;utiliser lorsque la tâche s&#8217;exécute :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.impl.Parameter

Parameter param = _parameterMap?.get("param") as Parameter
String res = param?.getValue()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_23_WSAttachmentInitializer"><a class="anchor" href="#_23_WSAttachmentInitializer"></a>26. <code><span style="color:#11da73">WSAttachmentInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_23"><a class="anchor" href="#_description_23"></a>26.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé lors de l&#8217;exécution des webservices sur les pièces jointes (ajout ou mise à jour).</p>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_21"><a class="anchor" href="#_paramètres_21"></a>26.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_docId</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Doc ID</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_attData</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IWSAttachmentUpdateType</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Attachment data</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_mode</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ScriptModeRun</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>*com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument<strong> 2+</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>secretLevel</strong>, <strong>codeFieldValues</strong>, <strong>ctxValues</strong>
et <strong>document</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_18"><a class="anchor" href="#_exemple_18"></a>26.3. Exemple</h3>
<div class="paragraph">
<p>Arrêt du chargement d&#8217;une pièce jointe si l&#8217;attribut <strong>label</strong> n&#8217;a pas été renseigné dans la requête.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-curl hljs" data-lang="curl">curl --location 'http://localhost:7373/dossierweb/rest/attachment/9097' \
  --header 'Authorization: Basic &lt;credencials&gt;' \
  --form 'attachmentData="{
      \"scriptCode\": \"test\"
  }";type=application/json'
  --form 'fileData=@"/path/document.docx"'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument
import com.digitech.dossier.webservices.type.WSAttachmentUpdateType

WSAttachmentUpdateType att = _attData
if(att.getLabel() == null) {
  _result.fillKOResult("Empty label")
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_24_WSDocumentInitializer"><a class="anchor" href="#_24_WSDocumentInitializer"></a>27. <code><span style="color:#11da73">WSDocumentInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_24"><a class="anchor" href="#_description_24"></a>27.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé lors de l&#8217;exécution des webservices sur les documents (ajout ou mise à jour).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Information"></i>
</td>
<td class="content">
<div class="paragraph">
<p>À la fois disponible pour le <code><span style="color:#0099ff">Web Service</span></code> <strong>WSDocument</strong> (endpoint <strong>/document</strong>)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_22"><a class="anchor" href="#_paramètres_22"></a>27.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>_docType</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>WSDocument</strong>: <strong>com.digitech.dossier.webservices.ws.document.type.WSDocumentType</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>_mode</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ScriptModeRun</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode (<strong>CREATE</strong> ou <strong>UPDATE</strong>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>secretLevel</strong>, <strong>codeFieldValues</strong>, <strong>ctxValues</strong> et <strong>document</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exemple_19"><a class="anchor" href="#_exemple_19"></a>27.3. Exemple</h3>
<div class="paragraph">
<p>Ajout de commentaire dans le champ <strong>CR_RESUME</strong> si le document est mis à jour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.model.backend.airs.IDocument
import com.digitech.dossier.script.model.impl.result.ScriptModeRun
import com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument
import java.text.SimpleDateFormat

def today = new Date()
def sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss")
if (_mode == ScriptModeRun.UPDATE) {
  IDocument doc = _document as IDocument
  String resume = doc.getField("CR_RESUME").getAirsValue()
  String newResume = resume + "\n" + "Mis à jour le " + sdf.format(today)
  _result.addFieldValue("CR_RESUME", newResume)
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Exemple d&#8217;ajout de commentaire dans le champ Résumé lors de la mise à jour d&#8217;un document</div>
<p><span class="image"><img src="images/examples/ws_document_initializer_example.png" alt="ws document initializer example"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_24_WSExtendDocumentInitializer"><a class="anchor" href="#_24_WSExtendDocumentInitializer"></a>28. <code><span style="color:#11da73">WSExtendDocumentInitializer</span></code></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_25"><a class="anchor" href="#_description_25"></a>28.1. Description</h3>
<div class="paragraph">
<p>Ce type de script est utilisé lors de l&#8217;exécution des webservices sur les documents (ajout ou mise à jour) en mode <span class="underline"><strong>étendu</strong></span>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Information"></i>
</td>
<td class="content">
<div class="paragraph">
<p>À la fois disponible pour le <code><span style="color:#0099ff">Web Service</span></code> (endpoint <strong>/extendDocument</strong>)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_paramètres_23"><a class="anchor" href="#_paramètres_23"></a>28.2. Paramètres</h3>
<div class="paragraph">
<p>cf. <a href="#_01_CommonData">attributs communs</a>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Nom</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Type</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph sub-header">
<p><em>Description</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>_docType</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>WSExtendDocument</strong>: <strong>com.digitech.dossier.webservices.extend.type.WSDocumentType</strong> ou</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>document structure</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_parentDocType</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.webservices.extend.type.WSDocumentType</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>parent document structure</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>_mode</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ScriptModeRun</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Mode</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><div class="content"><div class="paragraph header">
<p>Entrées/sorties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>_result</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>contient les variables <strong>secretLevel</strong>, <strong>codeFieldValues</strong>, <strong>ctxValues</strong>
et <strong>document</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_99_appendixes"><a class="anchor" href="#_99_appendixes"></a>29. Annexes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_99_appendixes_groovy"><a class="anchor" href="#_99_appendixes_groovy"></a>29.1. <code><span style="color:#2C8470">Groovy</span></code> Bonnes pratiques, astuces, &#8230;&#8203;</h3>
<div class="sect3">
<h4 id="_99_appendixes_groovy_conventions"><a class="anchor" href="#_99_appendixes_groovy_conventions"></a>29.1.1. <code><span style="color:#448279">Arcade GED</span></code>/<code><span style="color:#2C8470">Groovy</span></code> conventions.</h4>
<div class="paragraph">
<p>Toutes les variables contextuelles transférées par l&#8217;application <code><span style="color:#448279">Arcade GED</span></code> (et donc disponibles dans les scripts) sont préfixées du caractère
'<span class="blue-text"><strong>_</strong></span>'.</p>
</div>
<div class="paragraph">
<p>Le point virgule '<span class="blue-text"><strong>;</strong></span>' en fin d&#8217;instruction n&#8217;est pas nécessaire.</p>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_groovy_elvis"><a class="anchor" href="#_99_appendixes_groovy_elvis"></a>29.1.2. Opérateur <strong>elvis</strong></h4>
<div class="paragraph">
<p>Le langage <code><span style="color:#2C8470">Groovy</span></code> est (très) proche du langage <code><span style="color:#F24E52">Java</span></code>. En tout cas, le compilateur <code><span style="color:#2C8470">Groovy</span></code> interprète une syntaxe <strong>pure</strong> <code><span style="color:#F24E52">Java</span></code>.</p>
</div>
<div class="paragraph">
<p>Cependant, le langage se trouve enrichi (<em>du point de vue de l&#8217;auteur de ce document <span class="image emoji size-20"><img src="images/icons/smile-ok.svg" alt="ok" width="24" height="24"></span></em>) par certaines caractéristiques, notamment l&#8217;opérateur <a href="https://docs.groovy-lang.org/next/html/documentation/core-operators.html#_elvis_operator" target="_blank" rel="noopener"><strong>elvis</strong></a>, un raccourci à l&#8217;opérateur ternaire <code><span style="color:#F24E52">Java</span></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">displayName = user.name ? user.name : 'Anonymous'
// devient
displayName = user.name ?: 'Anonymous'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_groovy_safeop"><a class="anchor" href="#_99_appendixes_groovy_safeop"></a>29.1.3. Opérateur de navigation <em>"sécurisé"</em></h4>
<div class="paragraph">
<p>ou dans la langue de <em>Shakespeare</em> <strong>Safe Navigation Operator</strong>.</p>
</div>
<div class="paragraph">
<p>L&#8217;opérateur est identique à <em>elvis</em> et permet d&#8217;appel à des méthodes d&#8217;objet sans crainte de <strong>NullPointerException</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">// si person ou address ou home est NULL, roadNumber sera NULL
def roadNumber = person?.address?.home?.roadNumber</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Astuce"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Les <strong>2</strong> opérateurs précédemment décrits peuvent être utilisés conjointement !</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def roadNumber = person?.address?.home?.roadNumber ?: 666</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_groovy_scope"><a class="anchor" href="#_99_appendixes_groovy_scope"></a>29.1.4. Portée des variables</h4>
<div class="paragraph">
<p>En <code><span style="color:#2C8470">Groovy</span></code>, pour déclarer une variable</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Soit vous la déclarez directement, <strong>sans préfixe/type</strong>, votre variable - <span class="underline">Quelle que soit sa position dans le fichier/la classe</span> - sera alors
<strong>globale</strong> (<span class="underline">hors méthodes statiques !</span>)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">monText1 = "je suis une variable globale!"

def localFct() {
  monText2 = "je suis également une variable globale!"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Soit vous la préfixez du type souhaité ou du mot clé <strong>def</strong>, celle-ci sera alors <strong>locale</strong> au contexte</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">String monText1 = "je suis une variable locale!"

def localFct() {
  def monText2 = "je suis également une variable locale!"
  println(monText1 ?: "inconnue") // print "inconnue"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">exemple complet</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">logger = Logger.getLogger("scopeVariables")
y = 2

class GlobalProps {
  static def POOL_NAME = "dbName"
}

def localFunction() {
  def q = 333
  logger.info("y value: '{}'", y) // ok, print '2'
  logger.info("q value: '{}'", q) // ok, print '333'

  z = 666
}

static def staticFunction() {
  logger.info("dbName value: '{}'", GlobalProps.POOL_NAME) // // ok, print 'dbName'
  logger.info("y value: '{}'", y) // this will fail!
}

localFunction()
staticFunction()

logger.info("- Local variable doesn't exist outside")
logger.info("y value: '{}'", y) // ok, print '2'
logger.info("7 value: '{}'", z) // ok, print '666'
logger.info("q value: '{}'", q) // this will fail!</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_groovy_string_interpolation"><a class="anchor" href="#_99_appendixes_groovy_string_interpolation"></a>29.1.5. Substitution dans les chaines de caractères</h4>
<div class="paragraph">
<p>Comme indiqué dans la
<a href="https://docs.groovy-lang.org/latest/html/documentation/index.html#_string_interpolation" target="<em>blank"><strong>documentation</strong></a>,
il est possible de formater facilement des messages/chaines de caractères avec des données contextuelles en utilisant le _placeholder</em> '<span class="blue-text"><strong>${}</strong></span>' ou '<span class="blue-text"><strong>$</strong></span>'.</p>
</div>
<div class="listingblock">
<div class="title">String interpolation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def who = "n.felix"
_scriptLogger.info("hello ${who}!")
_scriptLogger.info("hello $who!")


def whoPerson = new PersonData(1, "n.felix")

_scriptLogger.info("hello $whoPerson.login! (id: $whoPerson.id")

class PersonData {
  Integer id
  String login
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_99_appendixes_utils"><a class="anchor" href="#_99_appendixes_utils"></a>29.2. Méthodes <code><span style="color:#448279">Arcade GED</span></code> utiles</h3>
<div class="paragraph">
<p>Vous trouverez dans ce chapitre quelques exemples/méthodes récurrentes sur vos divers projets.</p>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_conf"><a class="anchor" href="#_99_appendixes_utils_conf"></a>29.2.1. Répertoires de configuration</h4>
<div class="paragraph">
<p>La récupération des chemins absolus vers les répertoires de configuration d'<code><span style="color:#448279">Arcade GED</span></code> s&#8217;effectue comme il suit :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.AppConfigurationUtilsCore

// répertoire *xml*
AppConfigurationUtilsCore.getXMLConfigurationFolderPath()
// répertoire *config*
AppConfigurationUtilsCore.getConfigFolderPath()
// répertoire *config/script*
AppConfigurationUtilsCore.getGroovyScriptFolderPath()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_script_init"><a class="anchor" href="#_99_appendixes_utils_script_init"></a>29.2.2. Initialisation/Finalisation de script <code><span style="color:#2C8470">Groovy</span></code></h4>
<div class="paragraph">
<p>Chaque script <code><span style="color:#2C8470">Groovy</span></code> peut automatiquement appeler une méthode :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Au démarrage de l&#8217;application (ou à la recompilation du fichier). Cette méthode est nommée <span class="underline">setup</span>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.utils.ScriptUtilities

/**
 * (optional) method called when script is loaded (or reloaded)
 * */
void setup() {
  // initialisation du pool de connexion (par exemple)
  def poolJdbc = dd//

  // et mise en cache (voir chapitre suivant)
  ScriptUtilities.addToCache("poolScript", poolJdbc)
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A l&#8217;arrêt de l&#8217;application (ou avant la recompilation du fichier). Cette méthode est nommée <span class="underline">tearDown</span>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.utils.ScriptUtilities

/**
 * (optional) method called when script is unloaded (or before being reloaded)
 * */
void tearDown() {
  // libération du pool de connexion (par exemple)
  try {
    def poolJdbc = ScriptUtilities.getFromCache("poolScript")
    poolJdbc?.release()
  }
  finally{
    ScriptUtilities.removeFromCache("poolScript")
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_cache"><a class="anchor" href="#_99_appendixes_utils_cache"></a>29.2.3. Cache</h4>
<div class="paragraph">
<p>Il peut être intéressant de pouvoir conserver en mémoire des données pour les traiter, récupérer, &#8230;&#8203; entre plusieurs scripts ou entre plusieurs exécutions
d&#8217;un même script.</p>
</div>
<div class="paragraph">
<p>Pour cela, les méthodes suivantes peuvent être utilisées :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.script.utils.ScriptUtilities

// ajout au cache
ScriptUtilities.addToCache("&lt;key&gt;", obj)

// récupération du cache cache
def value = ScriptUtilities.getFromCache("&lt;key&gt;")

// suppression du cache
ScriptUtilities.removeFromCache("&lt;key&gt;")</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_properties"><a class="anchor" href="#_99_appendixes_utils_properties"></a>29.2.4. Lecture d&#8217;un fichier <strong>properties</strong></h4>
<div class="paragraph">
<p>Sur vos projets, peut-être aurez-vous besoin de lire un fichier <em>.properties</em> contenant des paramètres propres à votre environnement.</p>
</div>
<div class="listingblock">
<div class="title">Sample <strong>properties</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">airs.db.class=&lt;dbDriver&gt;
airs.db.url=&lt;dbUrl&gt;
airs.db.user=&lt;dbUser&gt;
airs.db.password=&lt;dbPwd&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.AppConfigurationUtilsCore
import com.digitech.dossier.script.utils.ScriptUtilities

def propFile = Paths.get(AppConfigurationUtilsCore.getXMLConfigurationFolderPath() + "ws.properties")

/**
 * Le 2ème paramètre ("wsProps") permet de mettre en cache le résultat.
 * Celui-ci sera recalculé seulement si le fichier est modifié (chargement à chaud)
 */
Properties conf = ScriptUtilities.getOrLoadProperties(propFile, "wsProps"/** &lt;cacheKey&gt;*/)

String driver = conf.getProperty("airs.db.class")</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_json_parser"><a class="anchor" href="#_99_appendixes_utils_json_parser"></a>29.2.5. Lecture d&#8217;un flux <strong>JSON</strong></h4>
<div class="paragraph">
<p>Il est fréquent de devoir extraire des données d&#8217;un flux <strong>JSON</strong>,<br>
celui pouvant provenir d&#8217;un fichier, d&#8217;une <code>API</code> <code><span style="color:#73A12E">REST</span></code>, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><code><span style="color:#2C8470">Groovy</span></code> fournit pour cela un <em>parser</em> très simple à utiliser :</p>
</div>
<div class="paragraph">
<p>L&#8217;exemple ci-dessous utilise pour source de données le fichier <strong>JSON</strong> disponible en <a href="#_99_samples_weather_json">annexe</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.json.JsonSlurper

JsonSlurper jsonParser = new JsonSlurper()

// weatherResponse a été récupéré précédemment, via un appel aux APIs *openweater*
def parsedJson = jsonParser.parseText(weatherResponse)

for(int i=0; i&lt;parsedJson.list.size; ++i) {
  def dayData = parsedJson.list[i]
  OpenWeatherDay newDay = new OpenWeatherDay(i)
  newDay.desc = dayData.weather[0].description
  newDay.icon = dayData.weather[0].icon
  newDay.tempDay = dayData.main.temp
  newDay.tempMin = dayData.main.temp_min
  newDay.tempMax = dayData.main.temp_max
  newDay.windSpeed = dayData.wind.speed

  // ok, l'instance *newDay* peut être stockée pour un traitement ultérieur (affichage, ...)
}

/**
 * inner class permettant de stocker les données relatives à la météo d'une journée
 */
class OpenWeatherDay {
  final int dayIdx
  String desc
  String icon
  int tempMin
  int tempMax
  int tempDay
  int windSpeed

  OpenWeatherDay(int dayIdx) {
    this.dayIdx = dayIdx
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_dbpool"><a class="anchor" href="#_99_appendixes_utils_dbpool"></a>29.2.6. Pool de connections à une base de données</h4>
<div class="paragraph">
<p>L&#8217;instanciation d&#8217;une connection à une base de données est une opération coûteuse, c&#8217;est pourquoi un <em>pool</em> de connections est fréquemment utilisé.</p>
</div>
<div class="paragraph">
<p>La classe <strong>SqlUtils</strong> permet de faciliter cette opération, comme il suit</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.sql.SqlUtils


def POOL_NAME = "dbPool"

// création ou récupération
def dbPool1 = SqlUtils.getOrCreatePool(POOL_NAME, "jdbc:oracle:thin:@//XXX", "&lt;user&gt;", "&lt;pwd&gt;", "oracle.jdbc.OracleDriver")

// récupération
def dbPool2 = SqlUtils.getPool(POOL_NAME)

// Libération
SqlUtils.releasePool(POOL_NAME)

// récupération d'une connexion à la base de données
try(def conn = SqlUtils.getPoolConnection(POOL_NAME)) {
  // vous pouvez alors travailler avec cette connexion à la base de données
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_sql"><a class="anchor" href="#_99_appendixes_utils_sql"></a>29.2.7. Récupération de données en base de données</h4>
<div class="paragraph">
<p>Opération fastidieuse et souvent redondante.</p>
</div>
<div class="paragraph">
<p>Utilisez donc la classe <strong>SqlUtils</strong> comme il suit :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.utils.sql.SqlUtils

def POOL_NAME = "dbPool"
List&lt;Map&lt;String, Object&gt;&gt; users = SqlUtils.runQuery(POOL_NAME, "select * from users")


// Il est possible de mapper les résultats directement dans un POJO
// soit l'attribut et le nom dans le pojo doivent correspondre
// soit l'alias et le nom dans le pojo doivent correspondre
List&lt;PersonData&gt; toto = SqlUtils.runQuery(POOL_NAME, "SELECT u.USR_ID, u.USR_LOGIN as \"login\" FROM users u", PersonData.class)

@groovy.transform.ToString
class PersonData {
  Integer usr_id
  String login
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_output_msg"><a class="anchor" href="#_99_appendixes_utils_output_msg"></a>29.2.8. Affichage d&#8217;un message en fin de traitement</h4>
<div class="paragraph">
<p>Les scripts qui sont exécutés manuellement (via une action utilisateur) peuvent afficher à l&#8217;écran un message de succès (ou échec) comme il suit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.digitech.dossier.common.resources.BundleUtils

try {
  // opération ici
  // ...
  _result.fillOKResult("User '$_userContext.userFullName' successfully did the job!")

} catch (Exception e) {
  _scriptLogger.error("Error while blabla...: '{}'", e.getLocalizedMessage(), e)
  _result.fillKOResult("Error while blabla...", e)
}


// Si le message doit être récupérés à partir des ressources, pour une gestion multi-langues, le code suivant doit être utilisé

_result.fillOKResult(BundleUtils.getTranslation("msg_key_OK", new Objevt[]{ _userContext.userFullName }))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_appendixes_utils_services"><a class="anchor" href="#_99_appendixes_utils_services"></a>29.2.9. Accès aux services communs d'<code><span style="color:#448279">Arcade GED</span></code></h4>
<div class="paragraph">
<p>La classe <strong>com.digitech.dossier.common.service.ServiceUtils</strong> contient la liste des services principaux d'<code><span style="color:#448279">Arcade GED</span></code>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Méthode</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>getDocumentService()</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>com.digitech.dossier.common.service.IDocument</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service d&#8217;accès au document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>getAuthorityListService()</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>com.digitech.dossier.common.service.IAuthorityList</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service d&#8217;accès aux listes d&#8217;autorité</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>getSearchService()</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>com.digitech.dossier.common.service.ISearch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service de recherche</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_99_appendixes_samples"><a class="anchor" href="#_99_appendixes_samples"></a>29.3. Quelques exemples</h3>
<div class="sect3">
<h4 id="_99_samples_displayRule_1"><a class="anchor" href="#_99_samples_displayRule_1"></a>29.3.1. <strong><code><span style="color:#11da73">DisplayRule</span></code></strong> Rendre visible une <strong class="yellow"><em>action custom</em></strong> si une pièce jointe est disponible</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">/**
 * Script de type {DisplayRule}
 * Variables en entrée: _scriptLogger, _result, _userContext, _document
 */

_scriptLogger.debug("&gt;&gt;&gt; sample_visibility (result: '{}', doc:'{}')", _result, _document)

_result.setValid(_document?.getAttachments(_userContext)?.size &gt; 0)

_scriptLogger.debug("&lt;&lt;&lt; sample_visibility")</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_99_samples_DocumentInitializer_1"><a class="anchor" href="#_99_samples_DocumentInitializer_1"></a>29.3.2. <strong><code><span style="color:#11da73">DocumentInitializer</span></code></strong> script sur déclenchement d&#8217;une <strong class="yellow"><em>action custom</em></strong></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">/**
 * Script de type {DocumentInitializer}
 * Variables disponible: _scriptLogger, _resultn _userContext, _document
 */

_scriptLogger.debug("&gt;&gt;&gt; sample_action (doc:'{}', ucc: '{}')", _document, _userContext)

try {
	// ajouter votre code ici...

  _result.fillOKResult("We did it!")

} catch (Exception e) {

  _scriptLogger.error("Error while ...: '{}'", e.getLocalizedMessage(), e)
  _result.fillKOResult("blabla error", e)
}

_scriptLogger.debug("&lt;&lt;&lt; sample_action")</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_autres_exemplesfichiers_divers"><a class="anchor" href="#_autres_exemplesfichiers_divers"></a>29.3.3. Autres exemples/fichiers divers</h4>
<div id="_99_samples_weather_json" class="listingblock">
<div class="title">Sample weather</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "cod": "200",
  "message": 0,
  "cnt": 5,
  "list": [
    {
      "dt": 1747386000,
      "main": {
        "temp": 19.75,
        "feels_like": 19.06,
        "temp_min": 18.9,
        "temp_max": 19.75,
        "pressure": 1011
      },
      "weather": [
        {
          "id": 500,
          "main": "Rain",
          "description": "légère pluie",
          "icon": "10d"
        }
      ],
      "wind": {
        "speed": 4.74,
        "deg": 181,
        "gust": 5.53
      },
      "visibility": 3047,
      "pop": 0.85,
      "rain": {
        "3h": 0.7
      }
    },
    {
      "dt": 1747396800,
      "main": {
        "temp": 19.34,
        "feels_like": 18.84,
        "temp_min": 18.53,
        "temp_max": 19.34,
        "pressure": 1012
      },
      "weather": [
        {
          "id": 500,
          "main": "Rain",
          "description": "légère pluie",
          "icon": "10d"
        }
      ],
      "wind": {
        "speed": 4.65,
        "deg": 241,
        "gust": 4.72
      },
      "visibility": 9707,
      "pop": 1,
      "rain": {
        "3h": 2.37
      }
    }
  ],
  "city": {
    "id": 2995469,
    "name": "Marseille",
    "coord": {
      "lat": 43.2965,
      "lon": 5.3698
    },
    "country": "FR",
    "population": 794811,
    "timezone": 7200,
    "sunrise": 1747368811,
    "sunset": 1747421788
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="highlightjs/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/javascript" src="tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="tools/codeTools.js"></script>
<script type="text/javascript" src="tools/tabs.js"></script>
<script type="text/javascript" src="tools/switchTheme.js"></script>
<script type="text/javascript">

  function initTabsAndTheme() {
    buildTabs();
    initTheme();
  }

  /* Tocbot dynamic TOC, works with tocbot 4.0.x */
  try {
    tocbot.init({
      contentSelector: '#content',
      headingSelector: 'h1, h2, h3, h4, h5',
      smoothScroll: true,
      headingsOffset: 40,
      scrollSmoothOffset: -40,
      orderedList: false
    });

    let oldtoc = document.getElementById('toctitle').nextElementSibling;
    const newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);

    const handleTocOnResize = function () {
      const width = window.innerWidth
          || document.documentElement.clientWidth
          || document.body.clientWidth;
      if (width < 768) {
        tocbot.refresh({
          contentSelector: '#content',
          headingSelector: 'h1, h2, h3, h4, h5',
          collapseDepth: 6,
          activeLinkClass: 'ignoreactive',
          throttleTimeout: 1000,
          smoothScroll: false
        });
      } else {
        tocbot.refresh({
          contentSelector: '#content',
          headingSelector: 'h1, h2, h3, h4, h5',
          smoothScroll:  true,
          headingsOffset: 40,
          scrollSmoothOffset: -40,
          orderedList: false
        });
      }
    };

    addCodeToolElements();
    switchInitialTheme();
    handleTocOnResize();
    window.addEventListener('resize', handleTocOnResize);
    window.addEventListener("load", initTabsAndTheme());
  }
  catch(err) {}


</script>
</body>
</html>