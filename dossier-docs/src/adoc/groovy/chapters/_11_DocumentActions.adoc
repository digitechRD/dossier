[[_11_DocumentActions]]
== {DocumentActions}

=== Description

Ce script est utilisé lors de la récupération des actions pour un document.

=== Paramètres

cf. <<_01_CommonData,attributs communs>>.

[options="noheader",cols="2a,2a,3a"]
|===
|[.sub-header]
_Nom_|[.sub-header]
_Type_|[.sub-header]
_Description_
3+|[.header]
Entrées
|*_document*|*com.digitech.dossier.common.model.backend.airs.IDocument*|Document courant
|*_fieldValueMap*|Map<String, IFieldValue>|Liste des champs

3+|[.header]
Entrées/sorties
|*_result*|*com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions*|contient les variables *allActions* (toutes les actions) et
*unavailableActions* (actions indisponibles)
|===

=== Exemple

Ajout de l'interdiction d'effectuer l'action *Verrouiller* pour un utilisateur n'ayant pas le profil _DOC_ADMIN_CLIENT_.

[source, groovy]
.Exemple : l'utilisateur courant n'est pas rattaché au profil *DOS_ADMIN_CLIENT*
----
import com.digitech.dossier.common.utils.UserUtils
import com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions

if(!UserUtils.hasProfile(_userContext, "DOS_ADMIN_CLIENT")) {
  _result.addUnavailableAction(ScriptResultValueDocumentActions.Action.LOCK)
}
----

[source, groovy]
.Exemple : l'utilisateur courant n'est pas le créateur du document
----
import com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions
import com.digitech.dossier.common.model.backend.Constants.AdvancedAuditType
import com.digitech.dossier.common.model.backend.airs.IDocument.IEvent

List<IEvent> events = _document.getEvents(AdvancedAuditType.ADV_EVENT_DOC_CREATE)

boolean canEdit = ((events?.size() ?: -1) > 0) && (events?.get(0)?.getUserId() == _userContext?.getUserId())
_scriptLogger.info("canEdit: {}, userID: {}", canEdit, _userContext?.getUserId())

if (!canEdit) {
  _result.addUnavailableAction(ScriptResultValueDocumentActions.Action.EDIT)
}
----

[source, groovy]
.Exemple : l'utilisateur courant n'est pas le REDACTEUR du document
----
import com.digitech.dossier.script.model.impl.result.ScriptResultValueDocumentActions

def uEditorID = _document.getFieldValue("CR_REDACTEUR")

if (_userContext?.getUserId() != uEditorID) {
  _result.addUnavailableAction(ScriptResultValueDocumentActions.Action.EDIT)
}
----

.Exemple de résultats de recherche pour un utilisateur n'ayant pas le droit de verrouiller les documents
image:examples/document_actions_example.png[]


