[[_24_WSDocumentInitializer]]
== {WSDocumentInitializer}

=== Description

Ce type de script est utilisé lors de l'exécution des webservices sur les documents (ajout ou mise à jour).

[NOTE]
====
À la fois disponible pour le {webservice} *WSDocument* (endpoint */document*)
====

=== Paramètres

cf. <<_01_CommonData,attributs communs>>.

[options="noheader",cols="2a,2a,3a"]
|===
|[.sub-header]
_Nom_|[.sub-header]
_Type_|[.sub-header]
_Description_
3+|[.header]
Entrées
|_docType|*WSDocument*: *com.digitech.dossier.webservices.ws.document.type.WSDocumentType*|
|_mode|ScriptModeRun|Mode (*CREATE* ou *UPDATE*)

3+|[.header]
Entrées/sorties
|*_result*|*com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument*|contient les variables *secretLevel*, *codeFieldValues*, *ctxValues* et *document*
|===

=== Exemple

Ajout de commentaire dans le champ *CR_RESUME* si le document est mis à jour.

[source, groovy]
----
import com.digitech.dossier.common.model.backend.airs.IDocument
import com.digitech.dossier.script.model.impl.result.ScriptModeRun
import com.digitech.dossier.script.model.impl.result.ScriptResultWSDocument
import java.text.SimpleDateFormat

def today = new Date()
def sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss")
if (_mode == ScriptModeRun.UPDATE) {
  IDocument doc = _document as IDocument
  String resume = doc.getField("CR_RESUME").getAirsValue()
  String newResume = resume + "\n" + "Mis à jour le " + sdf.format(today)
  _result.addFieldValue("CR_RESUME", newResume)
}
----

.Exemple d'ajout de commentaire dans le champ Résumé lors de la mise à jour d'un document
image:examples/ws_document_initializer_example.png[]