[[_12_DocumentChecker]]
== DocumentChecker

=== Description

Ce script est utilisé avant une recherche pour valider les critères.

=== Paramètres

cf. <<_01_CommonData,attributs communs>>.

[options="noheader",cols="2a,2a,3a"]
|===
3+|[.header]
Entrées|[.sub-header]
_Nom_|[.sub-header]
_Type_|[.sub-header]
_Description_
|*_search*|ISearchModel (recherche simple) ou IFtSearchModel (recherche fulltext)|Recherche
|*-parameters*|Map<String, Object>|Paramètres

3+|[.header]
Sortie
|[.sub-header]
_Nom_|[.sub-header]
_Type_|[.sub-header]
_Description_
|*_result*|*com.digitech.dossier.script.model.impl.result.ScriptResultValueChecker*|contient la variable *valid* qui détermine si la recherche est valide
|===

=== Exemples

.Blocage d'une recherche si une certaine condition est rencontrée.
[source,groovy]
----
boolean condition = checkIfSearchIsValid(_search)
result.setValid(condition)

private static boolean checkIfSearchIsValid(def sm) {
  //
  return ok
}
----

.Ajout d'un critère de recherche
[source,groovy]
----

if(!userCanSeeArchiveFolder(_userContext)) {
  _search.setAirsRequest(_search.getAirsRequest(_userContext)) + " ET ARCHIVE=0"
}

private static boolean userCanSeeArchiveFolder(IUserCoreContext uc) {
  // whatever...
  return uc.getProfileCodeList().contains("ARCHIVE_RIGHT")
}
----

.Ajout de critères de recherche (recherche fulltext)
[source,groovy]
----
import com.digitech.dossier.common.Utils
import com.digitech.dossier.common.model.backend.AdvancedDate
import com.digitech.dossier.common.model.backend.UserContext
import com.digitech.dossier.common.model.backend.airs.IFtSearchModel
import com.digitech.dossier.common.model.backend.airs.ILocutionModel
import com.digitech.dossier.common.service.FTFilter
import org.slf4j.Logger

import java.text.SimpleDateFormat

// Input parameters
UserContext usrContext = userContext
IFtSearchModel theSearch = search
Logger log = scriptLogger
FTFilter filter = theSearch.getFilter() as FTFilter

String contentType = "PRO_APP_DOSSIER"

if(Utils.getFullTextSearchController().getModel().getContentTypeCodeSelected().contains(contentType)) {

  Utils.getFullTextSearchController().getModel().addSearchFieldToFilter(filter, contentType, "PRO_APP_OS")
  filter.getLocutionMap().get("PRO_APP_OS").getBackendLocution().getField().setValue(74)

  Utils.getFullTextSearchController().getModel().addSearchFieldToFilter(filter, contentType, "D_CREAT")
  SimpleDateFormat formatter = new SimpleDateFormat("dd/MM/yyyy")
  String dateStr = "01/01/2017"
  Date date = formatter.parse(dateStr)
  String dateStr2 = "31/12/2017"
  Date date2 = formatter.parse(dateStr2)
  AdvancedDate advancedDate = new AdvancedDate()
  advancedDate.setStartValue(date)
  advancedDate.setFinishValue(date2)
  filter.getLocutionMap().get("D_CREAT").getBackendLocution().getField().setValues(Collections.singletonList(advancedDate))
  filter.getLocutionMap().get("D_CREAT").getBackendLocution().setOperator(ILocutionModel.Operator.OPERATOR_VALUE_BETWEEN)
}

----

